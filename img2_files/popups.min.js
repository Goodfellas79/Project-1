"use strict";define("popups/constants/closeButtonsConstants",[],function(){return{ICON:"icon",ICON_TYPE:"wysiwyg.viewer.components.PopupCloseIconButton",TEXT:"text",TEXT_TYPE:"wysiwyg.viewer.components.PopupCloseTextButton"}}),define("popups/presets/closeButtonsPresets",["lodash","popups/constants/closeButtonsConstants"],function(e,o){function t(t){var n=t.addPanel.getSectionsByComponentType(o.ICON_TYPE,null),p=e.get(n,"0.props.items.0.structure");return p.layout=e.omit(p.layout,["x","y"]),p}function n(e){return e.addPanelInfra.addPanelStyleManager.getComponentThemeStyles(o.TEXT_TYPE,e.theme,e.components)}function p(t){var p=t.addPanelInfra.componentsDefaultData.getComponentDefault(o.TEXT_TYPE),s=e.head(n(t));return p.layout=p.panelLayout,p.style=s,delete p.panelLayout,p}var s={};return s[o.ICON_TYPE]=t,s[o.TEXT_TYPE]=p,s}),define("popups/actions/closeButtonsActions",["lodash","util","popups/constants/closeButtonsConstants","popups/presets/closeButtonsPresets"],function(e,o,t,n){function p(e){a(e,t.ICON_TYPE,{y:20,right:20})}function s(e){a(e,t.TEXT_TYPE,{center:0,bottom:20})}function a(e,o,t){var p=e.pages.popupPages.getCurrentPopup(),s=e.pages.popupPages.getPopupContainer(),a=e.components.layout.get(s);a.width=Math.min(980,a.width);var i=r(n[o](e),a,t);e.components.add(s,i),e.history.add("added close "+o+" button to popup "+p.id)}function r(t,n,p){return e.defaults({layout:o.layoutUtils.convertAnyPositionToLeftTopPosition(e.assign({},t.layout,p),n)},t)}function i(e){d(e,t.ICON_TYPE)}function u(e){d(e,t.TEXT_TYPE)}function d(o,t){var n=o.pages.popupPages.getCurrentPopup(),p=o.components.get.byType(t,n);e.isEmpty(p)||(e.forEach(p,function(e){o.components.remove(e)}),o.history.add("removed close buttons from popup "+n.id))}return{addIconButton:p,addTextButton:s,removeIconButton:i,removeTextButton:u}}),define("popups/constants/openBehaviorsConstants",[],function(){return{DESKTOP:1,MOBILE:2,DESKTOP_AND_MOBILE:3,FLAG_DESKTOP:"openInDesktop",FLAG_MOBILE:"openInMobile",OPEN_DELAY_DEFAULT_VALUE:2,SITE_BEHAVIOR_TYPE:"site",LOAD_ACTION:"load",OPEN_POPUP_BEHAVIOR:"openPopup"}}),define("popups/queries/openBehaviorsQueries",["lodash","popups/constants/openBehaviorsConstants"],function(e,o){function t(t,n){return e.isEmpty(t)?n.behaviors.getDefinition(o.OPEN_POPUP_BEHAVIOR):t[0]}function n(e,n){return t(e,n).params[o.FLAG_MOBILE]}function p(e,o){return t(e,o).params.delay}function s(e){var o=e.documentServices.pages.popupPages.getCurrentPopupId();return e.pages.popupPages.getOpenBehaviorsForPopupWithId(o)}function a(o,t){var n=o.documentServices.siteSegments.getSiteStructureId();return e.find(t,{pageId:n})}function r(e,o){return!!a(e,o)}function i(o,t,n){var p=a(o,t);return p?e.map(n,function(o){return e.defaults({pageId:o},p)}):t}function u(o,t,n){var p=i(n,o,n.documentServices.pages.getPageIdList());return e(p).reject({popupId:t}).map("pageId").value()}return{isOpenInMobile:n,isMasterPageSelected:r,findMasterPageBehavior:a,getCurrentOpenBehaviors:s,getSomeBehavior:t,getDelay:p,getDenormalizedBehaviors:i,getDisabledPageIds:u}}),define("popups/mappers/getInfoForActions",["lodash","popups/queries/openBehaviorsQueries"],function(e,o){return function(t){var n=t.pages.popupPages.getCurrentPopup(),p=t.pages.popupPages.getOpenBehaviorsForPopups(),s=e.filter(p,{popupId:n.id}),a=o.getDisabledPageIds(p,n.id,t),r=t.documentServices.pages.getPageIdList();return{allPageIds:r,behaviorDefaults:o.getSomeBehavior(s,t).params,disabledPageIds:e.zipObject(a),enabledPageIds:e.difference(r,a),openBehaviors:s,popupPointer:n,selectedPageIds:e.map(s,"pageId")}}}),define("popups/actions/openBehaviorsActions",["core","lodash","popups/mappers/getInfoForActions","popups/queries/openBehaviorsQueries","popups/constants/openBehaviorsConstants"],function(e,o,t,n,p){function s(e){return o(e.enabledPageIds).union(e.selectedPageIds).size()}function a(e,o,t){var n=s(o);i(e,{all_pages_selected:t,num_selected_pages:t?n:0,num_unselected_pages:t?0:n})}function r(e,t,n,p){var a=s(t),r=n?o(t.selectedPageIds).push(p).size():o(t.selectedPageIds).pull(p).size();i(e,{all_pages_selected:a===r,num_selected_pages:r,num_unselected_pages:a-r})}function i(o,t){o.bi.event(e.bi.events.popups.POP_UP_SETTINGS_PAGE_SELECTOR_OK,t)}function u(e){var n=t(e),p=e.documentServices.pages.getPrimaryPageId();r(e,n,!0,p),o.has(n.disabledPageIds,p)||(m(e,n.openBehaviors),h(e,p,n.popupPointer.id,n.behaviorDefaults),e.history.add("assign open behavior only to current page"))}function d(e){var o=t(e);m(e,o.openBehaviors),a(e,o,!1),e.history.add("remove open behavior from all pages")}function g(e){var p=t(e),s=p.popupPointer.id,r=p.openBehaviors;n.isMasterPageSelected(e,r)||(o.isEmpty(p.disabledPageIds)?(m(e,r),h(e,e.documentServices.siteSegments.getSiteStructureId(),s,p.behaviorDefaults)):o(p.enabledPageIds).difference(p.selectedPageIds).forEach(function(o){h(e,o,s,p.behaviorDefaults)}),a(e,p,!0),e.history.add("assign open behavior to all pages"))}function c(e,p){var s=t(e),a=s.popupPointer.id,i=s.openBehaviors;if(!n.isMasterPageSelected(e,i)&&!o.has(s.disabledPageIds,p)){var u=s.selectedPageIds.concat(p);u.length>1&&u.length===s.allPageIds.length?(m(e,i),h(e,e.documentServices.siteSegments.getSiteStructureId(),a,s.behaviorDefaults)):h(e,p,a,s.behaviorDefaults),r(e,s,!0,p),e.history.add("assign open behavior to page")}}function l(e,o){var p=e.documentServices.pages.popupPages.getCurrentPopupId(),s=e.pages.popupPages.getOpenBehaviorsForPopupWithId(p),a=n.findMasterPageBehavior(e,s),i=t(e);a?f(e,a,o):I(e,o,p),r(e,i,!1,o),e.history.add("remove open behavior from page")}function P(e,t){var n=e.documentServices.pages.popupPages.getCurrentPopupId();e.pages.popupPages.getOpenBehaviorsForPopupWithId(n).forEach(function(n){h(e,n.pageId,n.popupId,o.defaults({openInMobile:t},n.params))}),e.history.add("toggle load on mobile")}function f(e,t,n){var p=o.without(e.documentServices.pages.getPageIdList(),n);I(e,e.documentServices.siteSegments.getSiteStructureId(),t.popupId),p.forEach(function(o){h(e,o,t.popupId,t.params)})}function v(e,t){var n=e.documentServices.pages.popupPages.getCurrentPopupId();e.pages.popupPages.getOpenBehaviorsForPopupWithId(n).forEach(function(n){h(e,n.pageId,n.popupId,o.defaults({delay:t},n.params))})}function h(e,o,t,n){var s=e.components.get.byId(o),a=e.components.get.byId(t),r=e.actions.getDefinition(p.LOAD_ACTION),i=e.behaviors.getDefinition(p.OPEN_POPUP_BEHAVIOR);i.params=n,e.behaviors.update(s,r,a,i)}function I(e,o,t){var n=e.components.get.byId(o),s=e.components.get.byId(t),a=e.actions.getDefinition(p.LOAD_ACTION),r=e.behaviors.getDefinition(p.OPEN_POPUP_BEHAVIOR);e.behaviors.remove(n,a,s,r)}function m(e,t){o.forEach(t,function(o){I(e,o.pageId,o.popupId)})}return{assignOpenBehaviorOnlyToCurrentPage:u,removeOpenBehaviorFromAllPages:d,assignOpenBehaviorToAllPages:g,assignOpenBehaviorToPage:c,removeOpenBehaviorFromPage:l,changeOpenDelay:v,toggleLoadOnMobile:P}}),define("popups/mappers/getPopupsInfoTitles",["lodash","popups/queries/openBehaviorsQueries"],function(e,o){return function(t,n){var p=e.map(n,"id"),s=t.pages.popupPages.getOpenBehaviorsForPopups(),a=e.partial(function(o,t){return e.get(o,[t,0,"title"],"")},e.groupBy(n,"id"));return{infoTitles:e(s).groupBy("popupId").mapValues(function(n){return o.isMasterPageSelected(t,s)?e.map(p,a):e(n).map("pageId").map(a).value()}).value()}}}),define("popups/queries/closeButtonsQueries",["lodash","popups/constants/closeButtonsConstants"],function(e,o){function t(o,t,n){var p=n.components.get.byType(o,t);return!e.isEmpty(p)}function n(e,o){var n={};return n[p.ICON]=t(p.ICON_TYPE,e,o),n[p.TEXT]=t(p.TEXT_TYPE,e,o),{has:n}}var p=o;return{getCloseButtonsInfo:n}}),define("popups/mappers/getDesktopPanelProps",["lodash","popups/queries/closeButtonsQueries","popups/queries/openBehaviorsQueries"],function(e,o,t){return function(n){var p=n.pages.popupPages.getCurrentPopup(),s=n.pages.popupPages.getOpenBehaviorsForPopups(),a=e.filter(s,{popupId:p.id}),r=o.getCloseButtonsInfo(p,n);return{delay:t.getDelay(a,n),hasIconButton:r.has.icon,hasTextButton:r.has.text,isMasterPageSelected:t.isMasterPageSelected(n,a),selectedPageIds:e.map(a,"pageId")}}}),define("popups/mappers/getMobilePanelProps",["popups/queries/openBehaviorsQueries"],function(e){return function(o){var t=e.getCurrentOpenBehaviors(o);return{shouldOpenInMobile:e.isOpenInMobile(t,o)}}}),define("popups/mappers/getPageSelectorPanelProps",["lodash","popups/queries/openBehaviorsQueries"],function(e,o){function t(e,o,t){return e<o&&o<t}var n=e.curry(function(e,o){var t=o[0].popupId;return e.pages.getPageTitle(t)});return function(p){var s=p.pages.popupPages.getCurrentPopup(),a=p.documentServices.pages.getPageIdList(),r=o.getDenormalizedBehaviors(p,p.pages.popupPages.getOpenBehaviorsForPopups(),a),i=e.filter(r,{popupId:s.id}),u=e.reject(r,{popupId:s.id}),d=e(u).groupBy("pageId").mapValues(n(p)).value(),g=e.difference(a,e.keys(d)),c=e.map(i,"pageId");return{selectAll:{visible:a.length>1,disabled:0===g.length,indeterminate:t(0,i.length,g.length),checked:c.length>0&&c.length===g.length},selectedPageIds:c,occupiedPages:d}}}),define("popups",["popups/actions/closeButtonsActions","popups/actions/openBehaviorsActions","popups/mappers/getPopupsInfoTitles","popups/mappers/getDesktopPanelProps","popups/mappers/getMobilePanelProps","popups/mappers/getPageSelectorPanelProps"],function(e,o,t,n,p,s){return{actions:{closeButtons:e,openBehaviors:o},mappers:{popupsList:t,desktopPanel:n,mobilePanel:p,pagesSelectorPanel:s}}});
//# sourceMappingURL=popups.min.js.map