"use strict";define("savePublish/utils/failedPanelUtil",["lodash"],function(e){function t(t){return e.get(t,"document.errorCode")}function n(t){return e.get(t,"document.errorType")}return{extractDocumentErrorCode:t,extractDocumentErrorType:n}}),define("savePublish/constants/savePublishErrorPanelData",[],function(){return{SITE_NAME_TAKEN_PANEL_DATA:{titleKey:"ERROR_SITE_NOT_RENAMED_TITLE_LABEL",description:"ERROR_SITE_NOT_RENAMED_BODY_SUBTITLE",steps:["ERROR_SITE_NOT_RENAMED_STEP1_TEXT","ERROR_SITE_NOT_RENAMED_STEP2_TEXT","ERROR_SITE_NOT_RENAMED_STEP3_TEXT"],stepsTitle:"ERROR_SITE_NOT_RENAMED_TRY_STEPS"},SAVE_DISABLED_ON_SERVER_PANEL_DATA:{titleKey:"SAVE_ERROR_TITLE_LABEL",description:"Save_Publish_ServerErrorLabel_OnSave",showSteps:!1,showFooterText:!1},USER_NOT_AUTHORIZED_FOR_SITE:{titleKey:"SAVE_ERROR_17_TITLE",description:"SAVE_ERROR_17_DESCRIPTION_HEADER",steps:["SAVE_ERROR_17_DESCRIPTION_STEP1","SAVE_ERROR_17_DESCRIPTION_STEP2","SAVE_ERROR_17_DESCRIPTION_STEP3"],helpMessage:"SAVE_ERROR_LEARN_MORE_LABEL",helpLinkMessage:"SAVE_ERROR_LEARN_MORE_LINK"},NOT_LOGGED_IN:{titleKey:"SAVE_ERROR_15_TITLE",description:"SAVE_ERROR_15_DESCRIPTION_HEADER",steps:["SAVE_ERROR_15_DESCRIPTION_STEP1","SAVE_ERROR_15_DESCRIPTION_STEP2","SAVE_ERROR_15_DESCRIPTION_STEP3"],helpMessage:"SAVE_ERROR_LEARN_MORE_LABEL",helpLinkMessage:"SAVE_ERROR_LEARN_MORE_LINK"},PUBLISH_DISABLED_ON_SERVER_PANEL_DATA:{titleKey:"PUBLISH_ERROR_TITLE_LABEL",description:"Save_Publish_ServerErrorLabel_OnPublish",showSteps:!1,showFooterText:!1},NAME_SITE_AGAIN_PANEL_DATA:{titleKey:"ERROR_NAME_SITE_AGAIN_TITLE_LABEL",description:"ERROR_NAME_SITE_AGAIN_SUBTITLE",steps:["ERROR_NAME_SITE_AGAIN_STEP1_TEXT","ERROR_NAME_SITE_AGAIN_STEP2_TEXT","ERROR_NAME_SITE_AGAIN_STEP3_TEXT"],stepsTitle:"ERROR_NAME_SITE_AGAIN_TRY_STEPS"},SAVE_ERROR_DEFAULT_PANEL_DATA:{titleKey:"SAVE_ERROR_TITLE_LABEL",description:"SAVE_PUBLISH_ERROR_BODY_DESCRIPTION",steps:["SAVE_PUBLISH_SAVE_ERROR_OPTION_1","SAVE_PUBLISH_SAVE_ERROR_OPTION_2"],stepsTitle:"SAVE_PUBLISH_ERROR_BODY_DESCRIPTION_BOLD",helpMessage:"SAVE_ERROR_LEARN_MORE_LABEL",helpLinkMessage:"SAVE_PUBLISH_ERROR_LEARN_MORE_LINK",helpLink:"8045e8e4-6f47-4913-8d74-6239f21fffec"},PUBLISH_ERROR_DEFAULT_PANEL_DATA:{titleKey:"PUBLISH_ERROR_TITLE_LABEL",description:"SAVE_PUBLISH_ERROR_BODY_DESCRIPTION",steps:["SAVE_PUBLISH_ERROR_OPTION_1","SAVE_PUBLISH_ERROR_OPTION_2"],helpMessage:"PUBLISH_ERROR_LEARN_MORE_LABEL",helpLinkMessage:"SAVE_PUBLISH_ERROR_LEARN_MORE_LINK",helpLink:"3de8a931-e665-4c9f-bcb3-7096ea89f9e3"},VALIDATION_ERROR:{titleKey:"AUTOSAVE_VALIDATION_ERROR_TITLE_LABEL",description:"AUTOSAVE_VALIDATION_ERROR_SENT1",showSteps:!1,helpMessage:"AUTOSAVE_ERROR_LEARN_MORE_LABEL",helpLinkMessage:"AUTOSAVE_ERROR_HELP_CENTER",helpLink:"c525bfda-f732-4fc1-9b9e-7a919d38721d",confirmLabel:"AUTOSAVE_VALIDATION_ERROR_BTN_RELOAD"}}}),define("savePublish/managers/saveManager",["lodash","core","util","savePublish/utils/failedPanelUtil","baseUI","savePublish/constants/savePublishErrorPanelData","experiment"],function(e,t,n,s,i,a,o){function r(r,l){function c(){for(var t=r.documentServices.siteName.getUsed(),s=n.translate("Save_Publish_Site_Default_Name"),i=r.siteName.sanitize(s.slice(0,20).replace(/\-$/,"").replace(/_/g,"-")),a=1;e.includes(t,i);){var o="-"+a;i=s.slice(0,20-o.length).replace(/\-$/,"").replace(/_/g,"-")+o,a++}return i}function u(n){switch(s.extractDocumentErrorType(n)){case r.errors.save.SITE_NAME_TAKEN:d(n,a.SITE_NAME_TAKEN_PANEL_DATA);break;case r.errors.save.SAVE_PUBLISH_DISABLED_ON_SERVER:d(n,a.SAVE_DISABLED_ON_SERVER_PANEL_DATA);break;case r.errors.save.NOT_LOGGED_IN:d(n,a.NOT_LOGGED_IN);break;case r.errors.save.USER_NOT_AUTHORIZED_FOR_SITE:d(n,a.USER_NOT_AUTHORIZED_FOR_SITE);break;case r.errors.save.DUPLICATE_COMPONENTS:case r.errors.save.DATA_REFERENCE_MISMATCH:case r.errors.save.MISSING_CONTAINERS:var i=e.partial(p,n);H=window.setInterval(i,t.constants.SAVE_PUBLISH.VALIDATION_ERROR_POPUP_INTERVAL),i();break;default:d(n,a.SAVE_ERROR_DEFAULT_PANEL_DATA)}}function p(t){if(!M([V.SAVE_FAILED])){var s=n.windowInteractionUtils.reloadPageWithoutQuestion;d(t,e.assign({},a.VALIDATION_ERROR,{onConfirm:s}))}}function h(t,n,s){var i=t||_,a=n||d,o=e.partial(f,i,a,s);r.panelManager.openPanel(V.CONCURRENT_SAVE,{overrideSaveMethod:o,onCancel:n,origin:s},!0)}function m(){r.panelManager.openPanel(V.SAVE_REMINDER,{saveMethod:e.partial(L,r,{origin:"remember_to_save_active_save_popup"})},!0)}function d(n,i){var o=t.bi.events.save.saveFailed,l=e.get(r.savePublish.getSiteState(),"isFirstSave"),c={errorCode:n&&s.extractDocumentErrorCode(n),biConfirm:l?o.First_Save_error_work_not_saved_error_ok_click:null,biHelp:l?o.First_Save_error_work_not_saved_error_help_center_link_click:null,biCancel:l?o.First_Save_error_work_not_saved_error_close_click:null},u=e({}).assign(i).defaults(a.SAVE_ERROR_DEFAULT_PANEL_DATA).assign(c).value();r.panelManager.openPanel(V.SAVE_FAILED,u,!0)}function _(t,n,s){if(E()){var i=e.merge({},r.savePublish.getSiteState(),t);i.overrideTitle=n,i.overrideSubtitle=s,r.panelManager.openPanel(V.SITE_WAS_SAVED,i,!0)}}function E(){return r.account.isUserOwner()&&!r.wixStores.isSiteInWixStoreTestDrive()}function P(t){t=e(t).pick(["overrideTitle","overrideSubtitle"]).assign({defaultSiteName:c(),freeDomainPrefix:r.domain.getFreeDomainPrefix(),connectDomainHandler:e.partial(v,t.origin,t.callback),freeDomainHandler:e.partial(b,t.origin,t.callback)}).value(),r.panelManager.openPanel(V.CHOOSE_DOMAIN,t,!0)}function S(e){var n=r.savePublish.getSiteState();r.panelManager.openPanel("savePublish.panels.connectDomain",{title:"SAVE_SITE_SAVED_TITLE_TITLE",subtitle:"PREMIUM_TITLE_SUBTITLE",onConnectDomainFlowEnded:e,isFirstSave:n.isFirstSave,isFirstPublish:!n.isSitePublished,isPremium:n.isSitePremium,flowId:t.constants.CONNECT_DOMAIN.FLOWS.SAVE},!0)}function b(t,n,s){N(s,e.partial(_,{callback:n}),e.partial(C,t),t)}function T(){function e(e){var t={isDomainConnected:e.isDomainConnected,isSitePremium:e.isSitePremium};e.isDomainConnected&&e.isSitePremium&&e.sitePublishedDomain&&(t.domain=e.sitePublishedDomain,r.documentServices.generalInfo.setPublicUrl(e.sitePublishedDomain)),r.savePublish.setSitePremiumState(t),_(t,F.SITE_SAVED_WELCOME_BACK_TITLE,F.SITE_SAVED_WELCOME_BACK_SUBTITLE)}r.site.getSiteDomainInfo(e,_)}function v(t){N(c(),S.bind(null,T),e.partial(C,t),t)}function I(e,t,n,s){function i(e){return function(t){r.savePublish.setSaveProgress(!1),r.bi.tryFlushingConditionedEvents(),e(t)}}r.savePublish.isSaveInProgress()&&t(),r.savePublish.setSaveProgress(!0),window.clearInterval(H),r.savePublish.save(i(e),i(t),n,s)}function f(e,t,n){I(e,t,!0,n)}function N(e,t,n,s){r.savePublish.isSaveInProgress()||(r.siteName.set(e),I(function(){A(),g(),t()},function(t){O(t)&&r.siteName.markAsUsed(e),n(t)},!0,s))}function A(){var t=r.documentServices.generalInfo.getSiteId(),s=r.documentServices.generalInfo.getMetaSiteId(),i=n.url.parseUrl(window.location.href).query;delete i.siteId,i.metaSiteId=s;var a=e.template(x)({siteId:t});a=n.url.setUrlParams(a,i),n.windowInteractionUtils.replaceState({},"",a)}function g(){e.size(r.documentServices.wixapps.classics.getAllAppPartComps("blog"))>0&&r.documentServices.wixapps.classics.reloadApp("blog")}function O(e){return r.errors.save.SITE_NAME_TAKEN===s.extractDocumentErrorType(e)}function C(e,t,n,i){s.extractDocumentErrorType(t)===r.errors.save.CONCURRENT_SAVE?h(n,i,e):i?i(t):u(t)}function D(e){r.panelManager.openPanel(V.ON_BOARDING_MIGRATION,{onConfirm:e},!0)}function R(){return r.documentServices.generalInfo.isSiteFromOnBoarding()}function L(n){if(r.savePublish.canSaveOrPublish())if(o.isOpen("se_obMigrationFlow")&&!e.get(n,"forceOBMigration")&&R())D(e.partial(L,e.defaults({forceOBMigration:!0},n)));else{var s=(n=n||{}).callback,i=n.origin,a=e.partial(C,i),u=r.savePublish.getSiteState();u&&u.isFirstSave?o.isOpen("googleDomain")&&r.domain.doesUserOwnGoogleDomain()?N(c(),e.partial(_,{callback:s}),a,i):P(n):I(function(){var e=r.getUserPreferences(),n=t.constants.USER_PREFS.SAVE.SITE_SAVED_DONT_SHOW_AGAIN;!e||!0!==e.session.get(n)?_({callback:s},"SAVE_SITE_SAVED_SMALL_TITLE_TITLE","SAVE_SITE_SAVED_SMALL_TITLE_SUBTITLE"):s&&s()},a,!1,n.origin)}else l.error("Site is being saved or published!")}function U(t,n,s,i){if(r.savePublish.canSaveOrPublish())if(o.isOpen("se_obMigrationFlow")&&!e.get(i,"forceOBMigration")&&R())D(U.bind(this,t,n,s,e.defaults({forceOBMigration:!0},i)));else{var a=r.savePublish.getSiteState();a&&a.isFirstSave?N(c(),t,n,s):I(t,function(e){C(s,e,t,n)},!1,s)}else l.error("Site is being saved or published!")}function y(){function n(){r.documentServices.generalInfo.isFirstSave()&&(!r.savePublish.canSaveOrPublish()||M(a)||r.zoomMode.isInZoomMode()||(m(),window.clearTimeout(l)),window.setTimeout(n,t.constants.SAVE_PUBLISH.SAVE_REMINDER_TIMEOUT))}function s(){r.documentServices.generalInfo.isFirstSave()&&(!r.savePublish.canSaveOrPublish()||M(a)||r.zoomMode.isInZoomMode()||(i.tooltipManager.showForDuration("save-button-tooltip",t.constants.SAVE_PUBLISH.SAVE_TOOLTIP_DURATION),r.bi.event(t.bi.events.save.saveReminder.REMINDER_DISPLAYED,{origin:"save tool-tip"})),l=window.setTimeout(s,t.constants.SAVE_PUBLISH.SAVE_TOOLTIP_TIMEOUT))}var a=[V.SAVE_REMINDER,V.CHOOSE_DOMAIN];window.setTimeout(n,t.constants.SAVE_PUBLISH.SAVE_REMINDER_TIMEOUT);var l=window.setTimeout(s,t.constants.SAVE_PUBLISH.SAVE_TOOLTIP_TIMEOUT);o.isOpen("se_obMigrationFlow")&&function(){e.invoke(r,"documentServices.generalInfo.isSiteFromOnBoarding")&&window.setTimeout(function(){i.tooltipManager.showForDuration("save-button-tooltip",t.constants.SAVE_PUBLISH.SAVE_TOOLTIP_DURATION)},2e3)}()}function M(t){return e.some(r.panelManager.getOpenPanels(),function(n){return e.includes(t,n.name)})}function B(t,n){function s(e,t){r.savePublish.setSaveProgress(!1),r.savePublish.setPublishProgress(!1),e&&e(t)}r.documentServices&&r.documentServices.generalInfo&&r.documentServices.generalInfo.getUserInfo().isStudio?(r.savePublish.isSaveInProgress()&&n(),r.savePublish.setSaveProgress(!0),r.savePublish.setPublishProgress(!0),k(),r.savePublish.saveAsTemplate(e.partial(s,t),e.partial(s,n))):l.info("Failed saving as template. User has no permissions to save as template")}function k(){var t=r.documentServices.pages.getPageIdList();e.forEach(t,function(e){w(e,"desktop"),w(e,"mobile")})}function w(e,t){var n=r.documentServices.pages.background.get(e,t);n&&!n.isPreset&&(n.isPreset=!0,r.pages.background.update(e,n,t))}var H,V={ON_BOARDING_MIGRATION:"savePublish.panels.save.onBoardingMigrationConfirmationPanel",CHOOSE_DOMAIN:"savePublish.panels.save.chooseDomainPanel",SITE_WAS_SAVED:"savePublish.panels.save.siteWasSavedPanel",SAVE_FAILED:"savePublish.panels.common.failPanel",CONCURRENT_SAVE:"savePublish.panels.save.concurrentSavePanel",SAVE_REMINDER:"savePublish.panels.save.saveReminderPanel"},F={SITE_SAVED_WELCOME_BACK_TITLE:"SAVE_SITE_SAVED_WELCOME_BACK_TITLE",SITE_SAVED_WELCOME_BACK_SUBTITLE:"SAVE_SITE_SAVED_WELCOME_BACK_SUBTITLE"},x=(n.serviceTopology.editorServerRoot||"//editor.wix.com/html/editor/web")+"/renderer/edit/<%= siteId %>";return{save:L,saveInBackground:U,saveAsTemplate:B,setTimerForSaveReminder:e.once(y),openConcurrentSavePanel:h,displayFailurePanelMatchingAnErrorType:u}}return r}),define("savePublish/constants/constants",["experiment"],function(e){function t(e,t){return/^config\d$/.test(e)?Number(e.replace("config","")):t}var n=e.getValue("se_autosaveActionCount"),s=e.getValue("se_saveAfterAutosaveCount");return n=t(n,2),s=t(s,3),{ERROR_CODES:{SAVE_PUBLISH_DISABLED_ON_SERVER:-10132},SAVE:{SAVE_FAILED_HELP_LINK:"8045e8e4-6f47-4913-8d74-6239f21fffec"},AUTOSAVE:{AUTOSAVE_TIMEOUT:5,AUTOSAVE_ACTION_COUNT:n,SAVE_AFTER_AUTOSAVE_COUNT:s,DEBOUNCE_WAIT:2},RENAME:{ERRORS:{SITE_NAME_TAKEN:-40003}}}}),define("savePublish/managers/autosaveManager",["lodash","util","core","experiment","constants","savePublish/constants/constants","savePublish/utils/failedPanelUtil","baseUI"],function(e,t,n,s,i,a,o,r){function l(l){function c(e,t){var n=!e||e.enable,s=u()||N();if(n&&s)return!1;var i=S(e);l.documentServices.initAutosave(i);var a=l.documentServices.generalInfo.isSiteFromOnBoarding();return!t&&i.enabled&&f()&&!a&&T(),i}function u(){var e=t.url.isQA(),n="true"===t.url.getParameterByName("forceAutosave");return e&&!n}function p(t){return e(["CONCURRENT_SAVE","CONCURRENT_AUTO_SAVE","SITE_STALE_STATE_FROM_AUTO_SAVE"]).map(e.propertyOf(l.errors.save)).includes(o.extractDocumentErrorType(t))}function h(t,n){var s;s="autosave"===t?n?"autosaveSuccessCount":"autosaveFailCount":n?"autoFullSaveSuccessCount":"autoFullSaveFailCount",e.isNaN(Number(window.testApi[s]))&&(window.testApi[s]=0),window.testApi[s]++}function m(){l.savePublish.setDiffSaveProgress(!0),f()&&l.updateState({savingStatus:A.IN_PROGRESS})}function d(i,a){var o=i?A.DONE_FAILED:A.DONE_SUCCESS,r=i?A.IDLE:A.IDLE_SAVED;if(l.savePublish.setDiffSaveProgress(!1),f()&&(l.updateState({savingStatus:o}),window.setTimeout(function(){l.updateState({savingStatus:r})},n.constants.SAVE_PUBLISH.DURATION_TO_SHOW_RESULT)),i&&p(i)){var c=l.documentServices.getAutoSaveInfo();s.isOpen("showConcurrentAutosaveDialog")?l.saveManager.openConcurrentSavePanel(e.noop,b,"autosave"):c&&c.shouldRestoreDiffs||l.documentServices.initAutosave(S({enabled:!1}))}l.bi.event(n.bi.events.save.autosave.DIFF_SAVED,{type:a,success:!i}),t.url.isQA()&&"undefined"!=typeof window&&window.testApi&&h("autosave",!i),P()}function _(){f()&&(l.savePublish.setSaveProgress(!0),l.updateState({savingStatus:A.IN_PROGRESS}))}function E(i){var a=i?A.DONE_FAILED:A.DONE_SUCCESS,o=i?A.IDLE:A.IDLE_SAVED;f()&&(l.savePublish.setSaveProgress(!1),l.updateState({savingStatus:a}),window.setTimeout(function(){l.updateState({savingStatus:o})},n.constants.SAVE_PUBLISH.DURATION_TO_SHOW_RESULT)),i&&(p(i)&&s.isOpen("showConcurrentAutosaveDialog")?l.saveManager.openConcurrentSavePanel(e.noop,b,"autosave"):l.saveManager.displayFailurePanelMatchingAnErrorType(i)),t.url.isQA()&&"undefined"!=typeof window&&window.testApi&&h("autoFullSave",!i),P()}function P(){l.bi.tryFlushingConditionedEvents()}function S(t){return e.assign({},{enabled:!0},{onDiffSaveStarted:m,onDiffSaveFinished:d,onPartialSaveStarted:_,onPartialSaveFinished:E},a.AUTOSAVE,t)}function b(){t.windowInteractionUtils.reloadPageWithoutQuestion()}function T(){var t=r.uiConstants.TOOLTIP.TRIGGERS;if(f())if(s.isOpen("newTopBar")){var a=i.ROOT_COMPS.TOPBAR.DROP_PANELS.CUSTOM.AUTO_SAVE;l.topBarMenuBar.openDropDown(a),window.setTimeout(l.topBarMenuBar.closeDropDown.bind(l,a),n.constants.SAVE_PUBLISH.SITE_AUTO_SAVED_TOOLTIP_DURATION)}else I({onClose:e.partial(v,l),props:{title:null,text:"TOPBAR_SITE_AUTOSAVE_TOOLTIP_BODY",link:"TOPBAR_SITE_AUTOSAVE_TOOLTIP_SITE_HISTORY",linkAction:function(){l.account.openRevisions()}},closeDelay:n.constants.SAVE_PUBLISH.SITE_AUTO_SAVED_TOOLTIP_DURATION,openTriggers:[t.IMMEDIATE],closeTriggers:[t.CLICK,t.MOUSE_LEAVE,t.TIMER]})}function v(){I(null)}function I(t){l.updateState({topBarCustomization:e.defaultsDeep({tooltipOverrides:{SAVE:t}},l.store.getState().topBarCustomization)})}function f(){var e=l.documentServices;if(!e)return!1;var t=e.getAutoSaveInfo(),n=t&&t.shouldAutoSave,i=N();return s.isOpen("se_autosaveUI")&&n&&!i}function N(){return l.documentServices.wixCode.isProvisioned()||l.developerMode.isEnabled()}var A=n.constants.PROGRESS_STATUS;return{init:c,getAutosaveConfig:S,showSiteAutoSavedTooltipIfNeeded:T,shouldShowAutosaveUI:f}}return l}),define("savePublish/managers/mockSaveManager",["lodash","core","savePublish/constants/savePublishErrorPanelData","coreUtilsLib"],function(e,t,n,s){function i(t){b=e.clone(t)}function a(t){b=e.merge(b||{},t)}function o(){for(var t=S.documentServices.siteName.getUsed(),n=S.documentServices.siteName.get(),s=n.slice(0,20),i=1;e.includes(t,s);){var a="-"+i;s=n.slice(0,20-a.length)+a,i++}return s}function r(){var e={defaultSiteName:o(),freeDomainPrefix:E,connectDomainHandler:h,freeDomainHandler:p};S.panelManager.openPanel(P.CHOOSE_DOMAIN,e,!0)}function l(){S.panelManager.openPanel("savePublish.panels.connectDomain",{title:"SAVE_SITE_SAVED_TITLE_TITLE",subtitle:"PREMIUM_TITLE_SUBTITLE",onConnectDomainFlowEnded:u.bind(this,"SAVE_SITE_SAVED_WELCOME_BACK_TITLE","SAVE_SITE_SAVED_WELCOME_BACK_SUBTITLE"),isFirstSave:!0,isFirstPublish:!0,isPremium:b.isSitePremium,flowId:t.constants.CONNECT_DOMAIN.FLOWS.SAVE},!0)}function c(){S.panelManager.openPanel(P.SAVE_FAILED,n.SAVE_ERROR_DEFAULT_PANEL_DATA,!0)}function u(t,n){var s=e.clone(b);s.isMockSave=!0,s.overrideTitle=t,s.overrideSubtitle=n,S.panelManager.openPanel(P.SITE_WAS_SAVED,s,!0)}function p(e){b.shouldSaveSucceed?(m(),a({domain:E+e}),u()):c()}function h(){b.shouldSaveSucceed?(m(),l()):c()}function m(){s.log.info("First Save Was Performed!")}function d(){s.log.info("Save Was Performed!")}function _(e){function t(e){e.isDomainConnected||(e.domain=E+o()),i(e),e.isFirstSave?r():e.shouldSaveSucceed?(d(),u("SAVE_SITE_SAVED_SMALL_TITLE_TITLE","SAVE_SITE_SAVED_SMALL_TITLE_SUBTITLE")):c()}(S=e).panelManager.openPanel("savePublish.panels.save.saveConfigurationPanel",{onConfirm:t},!0)}var E="http://www.wix.com/",P={CHOOSE_DOMAIN:"savePublish.panels.save.chooseDomainPanel",SITE_WAS_SAVED:"savePublish.panels.save.siteWasSavedPanel",SAVE_FAILED:"savePublish.panels.common.failPanel",CONCURRENT_SAVE:"savePublish.panels.save.concurrentSavePanel"},S=null,b=null;return{save:_}}),define("savePublish/panels/publish/publishInnerPanelTypes",["core"],function(e){var t=e.constants.USER_PREFS.PUBLISH;return{EMPTY:{name:"EMPTY"},SHOUTOUT:{name:"SHOUTOUT",userPref:t.SHOUTOUT_DONT_SHOW_AGAIN},CONNECT_DOMAIN:{name:"CONNECT_DOMAIN",userPref:t.CONNECT_DOMAIN_DONT_SHOW_AGAIN},GROW_BUSINESS:{name:"GROW_BUSINESS",userPref:t.GROW_BUSINESS_DONT_SHOW_AGAIN},MUSIC_PROMO:{name:"MUSIC_PROMO",userPref:t.MUSIC_PROMO_DONT_SHOW_AGAIN},PHOTOGRAPHY_PROMO:{name:"PHOTOGRAPHY_PROMO",userPref:t.PHOTOGRAPHY_PROMO_DONT_SHOW_AGAIN}}}),define("savePublish/managers/publishManager",["lodash","core","coreUtilsLib","savePublish/utils/failedPanelUtil","savePublish/constants/savePublishErrorPanelData","savePublish/panels/publish/publishInnerPanelTypes","experiment"],function(e,t,n,s,i,a,o){function r(r){function l(){function t(t){(t=e.assign({},t,{isFakePublish:!0})).shouldPublishSucceed&&!t.isSiteContributor?P(t):t.shouldPublishSucceed&&t.isSiteContributor?(n.log.info("Contributors dont get to see any post operations except failure."),_()):E()}r.panelManager.openPanel(M,{onConfirm:t})}function c(){r.savePublish.canSaveOrPublish()&&(u()?(d(),function(){function t(){U(function(t){P(e.assign(n,t)),_()},_)}var n={isFirstSave:r.documentServices.generalInfo.isFirstSave(),isPremiumUser:r.site.isPremium(),isFirstPublish:!r.documentServices.generalInfo.isSitePublished()};r.savePublish.publish(t,h)}()):p())}function u(){return r.account.isUserOwner()&&!r.wixStores.isSiteInWixStoreTestDrive()}function p(){r.savePublish.publish(_,h)}function h(e){switch(s.extractDocumentErrorType(e)){case r.errors.save.SAVE_PUBLISH_DISABLED_ON_SERVER:E(e,i.PUBLISH_DISABLED_ON_SERVER_PANEL_DATA);break;default:E(e,i.PUBLISH_ERROR_DEFAULT_PANEL_DATA)}_()}function m(e){if(r.savePublish.canSaveOrPublish()){if(r.documentServices.generalInfo.isFirstSave()){var t={overrideTitle:"PUBLISH_BEFORE_SAVE_CHOOSE_DOMAIN_TITLE",overrideSubtitle:"PUBLISH_BEFORE_SAVE_CHOOSE_DOMAIN_SUBTITLE",callback:c};return void r.saveManager.save(t)}r.saveManager.saveInBackground(c,h,e)}}function d(){r.savePublish.setPublishProgress(!0)}function _(){r.savePublish.setPublishProgress(!1)}function E(n,a){var o={errorCode:s.extractDocumentErrorCode(n),biConfirm:t.bi.events.publish.Publish_Work_not_Published_Error_ok_Click,biHelp:t.bi.events.publish.Publish_Work_not_Published_Error_Help_Center_Link_Click},l=e.chain(a).clone().defaults(i.PUBLISH_ERROR_DEFAULT_PANEL_DATA).assign(o).value();r.panelManager.openPanel(k,l,!0)}function P(t){var n=r.documentServices.generalInfo.getPublicUrl()||r.domain.getFreeDomainPrefix()+r.siteName.get();n=t.isDomainConnected?t.sitePremiumDomain:n;var s=T(t);if(S(t)&&b(t),!e.isEqual(s,a.EMPTY)){var i={isFakePanel:t.isFakePublish,contentPanelType:s,configuration:t,currentDomain:r.site.getCurrentSiteDomain(),userPreferences:r.getUserPreferences(),sitePublicUrl:n,closePanel:y};r.panelManager.openPanel(B,i,!0)}}function S(e){return!v()&&!I()&&!f(e)}function b(t){var n=r.store.getState(),s=D(t,R()),i=(n.savePublish.publishPanelPromotionIndex+1)%(s.length||1);r.updateState(e.merge(n.savePublish,{savePublish:{publishPanelPromotionIndex:i}}))}function T(e){var t=a.EMPTY;if(!e.isPremiumUser&&e.isDomainConnected)return t;var n=R();if(v())t=!n[a.MUSIC_PROMO.name].dontShowAgain||e.isFakePublish?a.MUSIC_PROMO:a.EMPTY;else if(I())t=!n[a.PHOTOGRAPHY_PROMO.name].dontShowAgain||e.isFakePublish?a.PHOTOGRAPHY_PROMO:a.EMPTY;else if(f(e))t=a.CONNECT_DOMAIN;else{var s=D(e,n);s.length&&(t=s[r.store.getState().savePublish.publishPanelPromotionIndex%s.length]||a.EMPTY)}return t}function v(){return o.isOpen("musicPromotionFixed")&&r.promotions.music.isActive()}function I(){return o.isOpen("photographyPromotionFixed")&&r.promotions.photography.isActive()}function f(e){return e.isFirstPublish&&!e.isDomainConnected}function N(e,t){var n=t[a.CONNECT_DOMAIN.name].dontShowAgain;return!e.isDomainConnected&&(!n||e.isFakePublish)}function A(e,t){var n=t[a.MUSIC_PROMO.name].dontShowAgain;return o.isOpen("musicPromotionRotation")&&r.promotions.music.isActive()&&(!n||e.isFakePublish)}function g(e,t){var n=t[a.PHOTOGRAPHY_PROMO.name].dontShowAgain;return o.isOpen("photographyPromotionRotation")&&r.promotions.photography.isActive()&&(!n||e.isFakePublish)}function O(e,t){var n=t[a.SHOUTOUT.name].dontShowAgain;return!e.isDomainConnected&&(!n||e.isFakePublish)}function C(e,t){var n=t[a.GROW_BUSINESS.name].dontShowAgain;return e.isPremiumUser&&e.isDomainConnected&&(!n||e.isFakePublish)}function D(e,t){var n=[],s=N(e,t),i=A(e,t),o=g(e,t),r=O(e,t),l=C(e,t);return s&&n.push(a.CONNECT_DOMAIN),i&&n.push(a.MUSIC_PROMO),o&&n.push(a.PHOTOGRAPHY_PROMO),i||o||!r||n.push(a.SHOUTOUT),l&&n.push(a.GROW_BUSINESS),n}function R(){var t={},n=e.reject(a,a.EMPTY);return e.forEach(n,function(e){t[e.name]=L(e.userPref)}),t}function L(e){var t=r.getUserPreferences();return{dontShowThisAgainKey:e,dontShowAgain:!!t&&t.session.get(e)}}function U(e,t){var n=function(t){var n=t.isDomainConnected,s=t.sitePublishedDomain;e({sitePremiumDomain:s,isDomainConnected:n})};r.site.getSiteDomainInfo(n,t)}function y(){return r.panelManager.closePanelByName(B)}var M="savePublish.panels.publish.config.publishConfigurationPanel",B="savePublish.panels.publish.publishSuccessPanel",k="savePublish.panels.common.failPanel";return{publish:c,saveAndPublish:m,configureMockPostPublish:l}}return r}),define("savePublish/panels/connectDomain/connectDomainPanel.rt",["react","lodash","panels","util","baseUI","symbols"],function(e,t,n,s,i,a){return function(){function t(){this.onClose(!1)}function s(){this.hoverOnAction(1)}function o(){this.hoverOnAction(2)}return e.createElement(n.frames.focusPanelFrame,{className:"connect-domain-panel save-publish-panel",panelName:this.props.panelName,shouldHideHeader:!0,frameClassName:"save-publish-panel-frame",keyboardShortcuts:this.getKeyboardShortcuts()},e.createElement("header",{className:"save-publish-panel-header"},e.createElement("button",{className:"close",onClick:t.bind(this)},e.createElement(a.symbol,{name:"headerCloseButton"})),e.createElement("span",{className:"title"},this.translateIfNeeded(this.props.title)),e.createElement("span",{className:"subtitle"},this.translateIfNeeded(this.props.subtitle))),e.createElement("div",{className:"actions"},e.createElement("a",{className:"action",onClick:this.connectToNewDomain,onMouseEnter:s.bind(this),onMouseLeave:this.resetHoverOnAction},e.createElement("div",{className:"action-graphics"},e.createElement(i.symbol,{name:"connectNewDomain"})),e.createElement("div",{className:"action-title"},this.translateIfNeeded("PREMIUM_BUTTON_1")),this.isActionHovered(1)?null:e.createElement("div",{key:"optionArrow",className:"action-arrow"},e.createElement(i.symbol,{name:"arrowWithCircle"})),this.isActionHovered(1)?e.createElement("div",{key:"optionLink",className:"action-arrow"},e.createElement(i.symbol,{name:"openLinkInWindow"})):null),e.createElement("a",{className:"action",onClick:this.connectExistingDomain,onMouseEnter:o.bind(this),onMouseLeave:this.resetHoverOnAction},e.createElement("div",{className:"action-graphics"},e.createElement(i.symbol,{name:"connectDomainLight"})),e.createElement("div",{className:"action-title"},this.translateIfNeeded("PREMIUM_BUTTON_2")),this.isActionHovered(2)?null:e.createElement("div",{key:"optionArrow",className:"action-arrow"},e.createElement(i.symbol,{name:"arrowWithCircle"})),this.isActionHovered(2)?e.createElement("div",{key:"optionLink",className:"action-arrow"},e.createElement(i.symbol,{name:"openLinkInWindow"})):null)),e.createElement("div",{className:"connect-domain-panel-footer"},e.createElement(i.button,{type:"button",label:"PREMIUM_BUTTON_LABEL",className:"maybe-later-button",onClick:this.maybeLater})))}}),define("savePublish/panels/connectDomain/connectDomainPanel",["react","jquery","lodash","core","util","savePublish/panels/connectDomain/connectDomainPanel.rt"],function(e,t,n,s,i,a){return e.createClass({displayName:"connectDomainPanel",mixins:[s.mixins.editorAPIMixin,i.translationMixin],propTypes:{isPremium:e.PropTypes.bool.isRequired,isFirstSave:e.PropTypes.bool,isFirstPublish:e.PropTypes.bool,title:e.PropTypes.string,subtitle:e.PropTypes.string,onConnectDomainFlowEnded:e.PropTypes.func,flowId:e.PropTypes.oneOf(n.values(s.constants.CONNECT_DOMAIN.FLOWS)).isRequired},getInitialState:function(){return{actionIndexHovered:-1}},connectToNewDomain:function(){var e=s.bi.events.save.siteWasSavedPanel.CONNECT_NEW_DOMAIN_CLICKED,t=this.openUpgrade.bind(this,"CONNECT_NEW_DOMAIN");this.props.isPremium&&(t=this.openConnectDomainInWindow.bind(this,"CONNECT_NEW_DOMAIN")),this.connectDomain(e,t)},connectExistingDomain:function(){var e=s.bi.events.save.siteWasSavedPanel.CONNECT_EXISTING_DOMAIN_CLICKED,t=this.openUpgrade.bind(this,"CONNECT_EXISTING_DOMAIN");this.props.isPremium&&(t=this.openConnectDomainInWindow.bind(this,"CONNECT_EXISTING_DOMAIN")),this.connectDomain(e,t)},connectDomain:function(e,t){this.props.isFirstSave&&this.getEditorAPI().bi.event(e);var n=this.listenToTabFocusIfNeeded();t.call(this),this.onClose(n)},listenToTabFocusIfNeeded:function(){if(this.props.onConnectDomainFlowEnded){var e=function(){this.getWindow().off("focus",e),this.props.onConnectDomainFlowEnded()}.bind(this);return this.getWindow().on("focus",this.onEditorFocus),!0}return!1},onEditorFocus:function(){this.getWindow().off("focus",this.onEditorFocus),this.props.onConnectDomainFlowEnded()},getReferralCode:function(e){var t="edhtml_";switch(this.props.flowId){case s.constants.CONNECT_DOMAIN.FLOWS.SAVE:t+="SAVE_FLOW_",t+=this.props.isFirstSave?"FIRST_SAVE_":"SECOND_SAVE_",t+=e;break;case s.constants.CONNECT_DOMAIN.FLOWS.TOP_BAR:t+="TOP_BAR_SITE_MENU_CONNECT_DOMAIN_"+e;break;case s.constants.CONNECT_DOMAIN.FLOWS.PUBLISH:t+="PUBLISH_FLOW_",t+=this.props.isFirstPublish?"FIRST_PUBLISH_":"SECOND_PUBLISH_",t+=e;break;case s.constants.CONNECT_DOMAIN.FLOWS.PUBLISH_BUTTON:t+="PUBLISH_FLOW_CONNECT_BUTTON_",t+=this.props.isFirstPublish?"FIRST_PUBLISH_":"SECOND_PUBLISH_",t+=e;break;default:t=null}return t},openUpgrade:function(e){var t=this.getReferralCode(e);this.getEditorAPI().account.upgrade(t)},openConnectDomainInWindow:function(e){var t=this.createURLWithParams("https://premium.wix.com/wix/api/domainConsole?siteGuid=<%= siteGUID %>&referralAdditionalInfo=<%= referralInfo %>",e);window.open(t)},createURLWithParams:function(e,t){var s=this.getReferralCode(t);return n.template(e)({siteGUID:this.getEditorAPI().documentServices.generalInfo.getSiteId(),referralInfo:s})},maybeLater:function(){this.getEditorAPI().bi.event(s.bi.events.save.siteWasSavedPanel.First_Save_Dialog_2_maybe_later_click),this.onClose(!1)},onClose:function(e){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName),!e&&this.props.onConnectDomainFlowEnded&&this.props.onConnectDomainFlowEnded()},getWindow:function(){return t(window)},resetHoverOnAction:function(){this.hoverOnAction(-1)},hoverOnAction:function(e){this.setState({actionIndexHovered:e})},isActionHovered:function(e){return this.state.actionIndexHovered===e},getKeyboardShortcuts:function(){var e=this;return{enter:function(){e.maybeLater()},esc:function(){e.onClose(!1)}}},render:a})}),define("savePublish/panels/connectDomain/connectDomainInProgress.rt",["react","lodash","panels","util","baseUI","symbols"],function(e,t,n,s,i,a){return function(){return e.createElement(n.frames.focusPanelFrame,{className:"connect-domain-in-progress-panel save-publish-panel",panelName:this.props.panelName,shouldHideHeader:!0,frameClassName:"save-publish-panel-frame",keyboardShortcuts:this.getShortcuts()},e.createElement("div",{className:"save-publish-panel-header"},e.createElement("div",{className:"title"},s.translate("PUBLISH_HANGON_TITLE")),e.createElement("div",{className:"subtitle"},s.translate("PUBLISH_HANGON_SUBTITLE")),e.createElement("button",{className:"close-button",onClick:this.onClose},e.createElement(a.symbol,{name:"headerCloseButton"}))),e.createElement("div",{className:"panel-content"},e.createElement("div",{className:"content-top-part"},e.createElement("div",{className:"content-graphics"},e.createElement(i.symbol,{name:"hangon"})),e.createElement("div",{className:"content-top-message"},"\n                ",s.translate("PUBLISH_HANGON_MAIN_TEXT"),"\n                ",e.createElement("span",{className:"public-url"},this.props.connectedDomainURL))),e.createElement("div",{className:"content-bottom-message"},"\n            ",s.translate("PUBLISH_HANGON_MEANTIME_TEXT"),"\n            ",e.createElement("a",{className:"content-bottom-message-link",onClick:this.openWorkingURL},s.translate("PUBLISH_HANGON_CLICKING_HERE_LINK")))),e.createElement("div",{className:"connect-domain-panel-footer"},e.createElement(i.button,{type:"button",className:"maybe-later-button",label:"PUBLISH_HANGON_DONE_BUTTON",onClick:this.onClose})))}}),define("savePublish/panels/connectDomain/connectDomainInProgress",["react","savePublish/panels/connectDomain/connectDomainInProgress.rt"],function(e,t){return e.createClass({displayName:"connectDomainInProgress",propTypes:{connectedDomainURL:e.PropTypes.string.isRequired,currentPublicURL:e.PropTypes.string.isRequired},getShortcuts:function(){return{esc:this.onClose,enter:this.onClose}},openWorkingURL:function(){window.open(this.props.currentPublicURL)},onClose:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},render:t})}),define("savePublish/panels/common/failPanel.rt",["react","lodash","util","baseUI","panels"],function(e,t,n,s,i){return function(){function a(t,s){return e.createElement("li",{key:t},n.translate(t))}return e.createElement(i.frames.messagePanelFrame,{panelName:this.props.panelName,className:"fail-panel",panelTitle:n.translate(this.props.titleKey),confirmLabel:this.getConfirmLabel(),footerText:this.props.showFooterText?this.getFooterText():null,keyboardShortcuts:this.getShortcuts()},e.createElement("div",{className:"content-wrapper"},e.createElement("div",{className:"icon"},e.createElement(s.symbol,{name:"plaster"})),-40108!==this.props.errorCode?e.createElement("div",{className:"textual",key:"619"},e.createElement("p",{className:"description",dangerouslySetInnerHTML:{__html:n.translate(this.props.description)}}),this.props.showSteps&&this.props.stepsTitle?e.createElement("div",{key:"stepsTitle",className:"steps-title"},n.translate(this.props.stepsTitle)):null,this.props.showSteps?e.createElement.apply(this,["ol",{key:"steps"},t.map(this.props.steps,a.bind(this))]):null):null,-40108===this.props.errorCode?e.createElement("div",{className:"textual",key:"1149"},e.createElement("h3",{},n.translate("PUBLISH_ERROR_SITE_DELETED_TITLE")),e.createElement("p",{className:"description"},n.translate("PUBLISH_ERROR_SITE_DELETED_BODY"))):null))}}),define("savePublish/panels/common/failPanel",["lodash","react","core","util","savePublish/panels/common/failPanel.rt"],function(e,t,n,s,i){return t.createClass({displayName:"failPanel",mixins:[n.mixins.editorAPIMixin],propTypes:{titleKey:t.PropTypes.string.isRequired,description:t.PropTypes.string.isRequired,stepsTitle:t.PropTypes.string,steps:t.PropTypes.array.isRequired,helpMessage:t.PropTypes.string.isRequired,helpLinkMessage:t.PropTypes.string.isRequired,helpLink:t.PropTypes.string.isRequired,errorCode:t.PropTypes.number,biEvent:t.PropTypes.object,biParams:t.PropTypes.object,failHelpId:t.PropTypes.string,biConfirm:t.PropTypes.object,biHelp:t.PropTypes.object,biCancel:t.PropTypes.object,onConfirm:t.PropTypes.func,confirmLabel:t.PropTypes.string},getDefaultProps:function(){return{showSteps:!0,showFooterText:!0,panelName:"savePublish.panels.common.failPanel"}},getShortcuts:function(){var e=this;return{esc:function(){e.getEditorAPI().panelManager.closePanelByName(e.props.panelName),e.onCancel()},enter:function(){e.getEditorAPI().panelManager.closePanelByName(e.props.panelName),e.onConfirm()}}},getErrorCodeMessage:function(){return void 0!==this.props.errorCode&&null!==this.props.errorCode?" (Error Code: "+this.props.errorCode+")":""},getFooterText:function(){return-40108===this.props.errorCode?"":t.DOM.p({className:"fail-panel-help-text"},t.DOM.span({className:"text-part"},s.translate(this.props.helpMessage)),t.DOM.a({onClick:this.openHelpLink,className:"link-part"},s.translate(this.props.helpLinkMessage)),t.DOM.span({className:"error-code-part"},this.getErrorCodeMessage()))},getConfirmLabel:function(){return-40108===this.props.errorCode?"PUBLISH_ERROR_SITE_DELETED_LINK":this.props.confirmLabel||"SAVE_PUBLISH_ERROR_BUTTON_OK"},onCancel:function(){this.props.biCancel&&this.getEditorAPI().bi.event(this.props.biCancel)},onConfirm:function(){this.props.biConfirm&&this.getEditorAPI().bi.event(this.props.biConfirm),-40108!==this.props.errorCode?e.invoke(this.props,"onConfirm"):window.location="https://wix.com/"},openHelpLink:function(){var e=this.getEditorAPI();this.props.biHelp&&this.getEditorAPI().bi.event(this.props.biHelp);var t={panel_name:this.props.panelName,origin:n.constants.BI.HELP.ORIGIN.PANEL,learn_more:!0};e.panelManager.openHelpCenter(this.props.helpLink,null,t),e.panelManager.closePanelByName(this.props.panelName)},sendPanelLoadedBiEvent:function(){this.props.biEvent&&this.props.biParams&&this.getEditorAPI().bi.event(this.props.biEvent,this.props.biParams)},componentDidMount:function(){this.sendPanelLoadedBiEvent()},render:i})}),define("savePublish/panels/common/commonPanels",["savePublish/panels/common/failPanel"],function(e){return{failPanel:e}}),define("savePublish/panels/save/chooseDomainPanel.rt",["react","lodash","panels","baseUI","symbols"],function(e,t,n,s,i){return function(){function a(e){this.handleDomainOptionSelected(e.value)}function o(){var n=this.getOptions()[this.DomainStates.FREE];return e.createElement("label",{className:t({"domain-option":!0,checked:this.state.domainChoice===this.DomainStates.FREE}).transform(function(e,t,n){t&&e.push(n)},[]).join(" ")},e.createElement("span",{className:"domain-option-label"},n.label),e.createElement("input",{className:"domain-option-radio-button",type:"radio",name:"domain-options",value:n.value,checked:this.state.domainChoice===n.value,onChange:a.bind(this,n)}),e.createElement("span",{}),e.createElement("div",{className:"domain-input"},e.createElement(s.domainInput,{value:n.domain,onChange:this.handleDomainChanged,prefix:n.prefix,isEditable:n.isEditable,domainValidator:n.domainValidator,biHandler:this.domainInputBiReporter})))}function r(e){this.handleDomainOptionSelected(e.value)}function l(){var n=this.getOptions()[this.DomainStates.BUY];return e.createElement("label",{className:t({"domain-option":!0,checked:this.state.domainChoice===this.DomainStates.BUY}).transform(function(e,t,n){t&&e.push(n)},[]).join(" ")},e.createElement("span",{className:"domain-option-label"},n.label),e.createElement("input",{className:"domain-option-radio-button",type:"radio",name:"domain-options",value:n.value,checked:this.state.domainChoice===n.value,onChange:r.bind(this,n)}),e.createElement("span",{}),e.createElement("span",{className:"connect-domain-example"},n.domain))}return e.createElement(n.frames.focusPanelFrame,{className:"choose-domain-panel save-publish-panel",panelName:this.props.panelName,shouldHideHeader:!0,frameClassName:"save-publish-panel-frame",keyboardShortcuts:this.getKeyboardShortcuts()},e.createElement("header",{className:"save-publish-panel-header"},e.createElement("button",{className:"close",onClick:this.close},e.createElement(i.symbol,{name:"headerCloseButton"})),e.createElement("span",{className:"title"},this.getTitle()),e.createElement("span",{className:"subtitle"},this.getSubtitle())),o.apply(this,[]),l.apply(this,[]),e.createElement(s.button,{className:"choose-domain-action-button",shouldTranslate:!1,label:this.getActionButtonLabel(),onClick:this.handleAction,disabled:this.state.isActionDisabled}))}}),define("savePublish/panels/save/chooseDomainPanel",["react","lodash","core","util","savePublish/panels/save/chooseDomainPanel.rt"],function(e,t,n,s,i){return e.createClass({displayName:"chooseDomainPanel",mixins:[n.mixins.editorAPIMixin],propTypes:{defaultSiteName:e.PropTypes.string.isRequired,freeDomainPrefix:e.PropTypes.string.isRequired,freeDomainHandler:e.PropTypes.func.isRequired,connectDomainHandler:e.PropTypes.func.isRequired,overrideTitle:e.PropTypes.string,overrideSubtitle:e.PropTypes.string},DomainStates:{FREE:"free",BUY:"buy"},getInitialState:function(){var e=this.getEditorAPI().siteName.validate(this.props.defaultSiteName);return{domainChoice:this.DomainStates.FREE,siteName:this.props.defaultSiteName,sanitizedSiteName:this.props.defaultSiteName,isActionDisabled:!e.success}},getTitle:function(){return s.translate(this.props.overrideTitle||"SAVE_CHOOSE_DOMAIN_TITLE_TITLE")},getSubtitle:function(){return s.translate(this.props.overrideSubtitle||"SAVE_CHOOSE_DOMAIN_TITLE_SUBTITLE")},getOptions:function(){var e={};return e[this.DomainStates.FREE]={value:"free",label:s.translate("SAVE_CHOOSE_DOMAIN_BODY_RADIO_BUTTON_1"),prefix:this.props.freeDomainPrefix,domain:this.state.siteName,isEditable:this.state.domainChoice===this.DomainStates.FREE,domainValidator:this.getEditorAPI().siteName.validate},e[this.DomainStates.BUY]={value:"buy",label:s.translate("SAVE_CHOOSE_DOMAIN_BODY_RADIO_BUTTON_2_LINE1"),domain:s.translate("SAVE_CHOOSE_DOMAIN_BODY_RADIO_BUTTON_2_LINE2"),isEditable:!1},e},getNextDomainOptionValue:function(){return this.state.domainChoice===this.DomainStates.FREE?this.DomainStates.BUY:this.DomainStates.FREE},getActionButtonLabel:function(){return s.translate("SAVE_CHOOSE_DOMAIN_BUTTON_SAVENCONTINUE")},handleDomainChanged:function(e){var t={};t.isActionDisabled=!e.isValid,t.siteName=e.value,t.sanitizedSiteName=e.sanitizedValue,this.setState(t)},handleDomainOptionSelected:function(e){if(!t.isEqual(this.state.domainChoice,e)){var n={domainChoice:e};if(e===this.DomainStates.BUY)n.isActionDisabled=!1,n.siteName=this.props.defaultSiteName,n.sanitizedSiteName=this.props.defaultSiteName;else{var s=this.getEditorAPI().siteName.validate(this.props.defaultSiteName);n.isActionDisabled=!s.success}this.setState(n),this.reportDomainClickedBI(e)}},handleAction:function(){if(this.reportActionButtonClickedBI(this.state.domainChoice),this.state.isActionDisabled)throw new Error("Should not get to handleAction if continue button is disabled");this.state.domainChoice===this.DomainStates.FREE?(this.close(),this.props.freeDomainHandler(this.state.sanitizedSiteName)):this.state.domainChoice===this.DomainStates.BUY&&(this.close(),this.props.connectDomainHandler())},reportActionButtonClickedBI:function(e){var t=this.getEditorAPI(),s=e===this.DomainStates.BUY?"connect your own domain":"free WIX domain";t.bi.event(n.bi.events.save.chooseDomainPanel.ACTION_BUTTON_CLICKED,{value_selected:s})},reportDomainClickedBI:function(e){var t=this.getEditorAPI(),s=e===this.DomainStates.BUY?"connect your own domain":"free WIX domain";t.bi.event(n.bi.events.save.chooseDomainPanel.DOMAIN_OPTION_CLICKED,{selection:s})},getUserStatus:function(){var e="";return this.props.isSitePublished||(e+="not_"),e+="published_",this.props.isDomainConnected||(e+="not_"),e+="connected"},domainInputBiReporter:function(e){var t={user_status:"not_published_not_connected",panel_name:this.props.panelName,save_or_publish:"save",is_first_save_or_publish:1};this.getEditorAPI().bi.event(n.bi.events.domainInput[e],t)},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},getKeyboardShortcuts:function(){var e=this;return{enter:function(){e.state.isActionDisabled||e.handleAction()},esc:function(){e.close()},tab:function(t){e.handleDomainOptionSelected(e.getNextDomainOptionValue()),t.preventDefault()}}},render:i})}),define("savePublish/panels/save/siteWasSavedPanel.rt",["react","lodash","panels","baseUI","baseUILib","util","symbols"],function(e,t,n,s,i,a,o){return function(){function r(e,n){var s=t.assign({},e,n);return e.hasOwnProperty("style")&&(s.style=t.defaults(s.style,e.style)),e.hasOwnProperty("className")&&n.hasOwnProperty("className")&&(s.className=n.className+" "+e.className),s}function l(){var t=this.getInnerPanel();return e.createElement("div",{className:"wrapper"},e.createElement("div",{className:"domain-input"},e.createElement(s.domainInputWithEditButtons,this.getDomainInputProps())),this.shouldDisplayInnerPanel()?e.createElement(t,r({key:"innerPanel",className:"inner-panel "+this.getInnerPanelClass()},this.getInnerPanelProps())):null,e.createElement("div",{className:"site-saved-footer"},this.props.isFirstSave?null:e.createElement(i.Checkbox,{key:"dontShowAgainCheckbox",className:"dont-show-again",label:"SAVE_PUBLISH_DO_NOT_SHOW_AGAIN_LABEL",valueLink:{value:this.state.doNotShowAgain,requestChange:this.handleDontShowAgainClicked},labelAfterSymbol:!0}),this.props.isSitePremium&&!this.props.isDomainConnected&&this.props.isFirstSave?e.createElement("span",{key:"needHelpConnectingDomain",className:"help-connecting-domain"},a.translate("SAVE_SITE_SAVED_NEED_HELP_LABEL")+" ",e.createElement("a",{target:"_blank",href:a.translate("SAVE_SITE_SAVED_NEED_HELP_URL"),onClick:this.handleNeedHelpConnectingDomainClicked},a.translate("SAVE_SITE_SAVED_NEED_HELP_LINK"))):null,e.createElement("div",{className:"footer-buttons"},this.props.isSitePublished?e.createElement(s.button,{onClick:this.continueToPublish,key:"publishButton",className:"publish-button btn-confirm-secondary",label:"SAVE_SITE_SAVED_WHATS_NEXT_PUBLISH_LINK",disabled:this.state.isContinueDisabled}):null,e.createElement(s.button,{className:"continue-button btn-confirm-primary",label:"SAVE_SITE_SAVED_BUTTON_OK",onClick:this.continueEditing,disabled:this.state.isContinueDisabled}))))}return e.createElement(n.frames.focusPanelFrame,{className:this.getPanelClass(),panelName:this.props.panelName,shouldHideHeader:!0,frameClassName:"save-publish-panel-frame",keyboardShortcuts:this.getKeyboardShortcuts()},e.createElement("header",{className:"save-publish-panel-header"},e.createElement("button",{className:"close",onClick:this.close},e.createElement(o.symbol,{name:"headerCloseButton"})),e.createElement("span",{className:"title"},this.getPanelTitle()),e.createElement("span",{className:"subtitle"},this.getPanelSubtitle())),l.apply(this,[]))}}),define("savePublish/panels/content/generalContent.rt",["react","lodash","baseUILib","baseUI"],function(e,t,n,s){return function(){return e.createElement("div",{className:this.getClassName()},e.createElement("div",{className:"main-title-wrapper"},e.createElement(n.Divider,{long:!0}),e.createElement("div",{className:"main-title"},this.translateIfNeeded(this.props.mainTitle)),e.createElement(n.Divider,{long:!0})),e.createElement("div",{className:"middle-spacer"}),e.createElement("div",{className:"bottom-section"},e.createElement("div",{className:"left-side"},this.props.symbolName?e.createElement(s.symbol,{name:this.props.symbolName,key:"symbol"}):null,this.props.imageSrc?e.createElement("img",{key:"image",src:this.props.imageSrc,style:this.props.imageStyle||{}}):null),e.createElement("div",{className:"right-side"},e.createElement("div",{className:"title"},this.translateIfNeeded(this.props.title)),this.props.subtitle?e.createElement("div",{key:"subtitle",className:"subtitle",dangerouslySetInnerHTML:{__html:this.translateIfNeeded(this.props.subtitle)}}):null,e.createElement("a",{className:"general-content-action",onClick:this.props.actionCallback},this.translateIfNeeded(this.props.actionLabel)))))}}),define("savePublish/panels/content/generalContent",["react","panels","util","savePublish/panels/content/generalContent.rt"],function(e,t,n,s){return e.createClass({displayName:"generalContent",mixins:[n.translationMixin],propTypes:{symbolName:e.PropTypes.string,imageSrc:e.PropTypes.string,imageStyle:e.PropTypes.object,mainTitle:e.PropTypes.string.isRequired,title:e.PropTypes.string.isRequired,subtitle:e.PropTypes.string,actionCallback:e.PropTypes.func.isRequired,actionLabel:e.PropTypes.string.isRequired,className:e.PropTypes.string},getClassName:function(){return"general-content"+(this.props.className?" "+this.props.className:"")},render:s})}),define("savePublish/panels/content/connectDomain.rt",["react","lodash","savePublish/panels/content/generalContent"],function(e,t,n){return function(){return e.createElement(n,function(e,n){var s=t.assign({},e,n);return e.hasOwnProperty("style")&&(s.style=t.defaults(s.style,e.style)),e.hasOwnProperty("className")&&n.hasOwnProperty("className")&&(s.className=n.className+" "+e.className),s}({className:"connect-domain-content "+this.props.className},this.getGeneralContentProps()))}}),define("savePublish/panels/content/connectDomain",["lodash","core","react","util","savePublish/panels/content/connectDomain.rt","experiment"],function(e,t,n,s,i,a){function o(){return{symbolName:"connectDomain_50",className:"personal-sale-campaign",subtitle:e.template(s.translate("SAVE_PUBLISH_WHATS_NEXT_PERSONAL_SALE_TEXT_DYNAMIC"))({discount:"50"})}}var r=a.isOpen("spanishUpgradeText")?"UPGRADE_NOW_FOR_SPAIN_ONLY":"SAVE_PUBLISH_WHATS_NEXT_UPGRADE_LINK";return n.createClass({displayName:"connectDomain",mixins:[t.mixins.editorAPIMixin],propTypes:{className:n.PropTypes.string,closePanel:n.PropTypes.func.isRequired,sitePublishedDomain:n.PropTypes.string,isDomainConnected:n.PropTypes.bool,isFirstPublish:n.PropTypes.bool,isSitePremium:n.PropTypes.bool,isFirstSave:n.PropTypes.bool,actionCallback:n.PropTypes.func,flowId:n.PropTypes.oneOf(e.values(t.constants.CONNECT_DOMAIN.FLOWS)).isRequired},getGeneralContentProps:function(){var t=this.getEditorAPI(),n={className:"",symbolName:"connectDomain",mainTitle:s.translate("SAVE_SITE_SAVED_WHATS_NEXT_LABEL"),title:s.translate("SAVE_PUBLISH_WHATS_NEXT_CONNECT_LINE1"),actionLabel:s.translate(this.props.isSitePremium?"SAVE_PUBLISH_WHATS_NEXT_CONNECT_LINK":r),shouldTranslate:!1,actionCallback:this.panelAction,subtitle:s.translate("SAVE_PUBLISH_WHATS_NEXT_CONNECT_LINE2")};return t.campaigns.personalSale.isActiveCampaign()&&!this.props.isSitePremium&&e.assign(n,o()),n},panelAction:function(){this.props.actionCallback&&this.props.actionCallback(),this.props.closePanel(),this.isSiteBeingConnectedToDomain()?this.openConnectDomainInProgressPanel():!this.props.isDomainConnected&&this.props.isSitePremium?this.getEditorAPI().account.openConnectDomain(this.props.flowId):this.getEditorAPI().account.upgrade(this.getUpgradeReferralCode())},getUpgradeReferralCode:function(){var e="edhtml_";switch(this.props.flowId){case t.constants.CONNECT_DOMAIN.FLOWS.PUBLISH:e+="PUBLISH_FLOW_"+(this.props.isFirstPublish?"FIRST_PUBLISH":"SECOND_PUBLISH");break;case t.constants.CONNECT_DOMAIN.FLOWS.SAVE:e+="SAVE_FLOW_SECOND_SAVE_AND_PUBLISHED";break;default:e=null}return e},isSiteBeingConnectedToDomain:function(){return this.isUnconnectedDomainPremium()&&!e.isEmpty(this.props.sitePublishedDomain)&&!e.includes(this.props.sitePublishedDomain,"wix.com")},isUnconnectedDomainPremium:function(){return!this.props.isDomainConnected&&this.props.isSitePremium},openConnectDomainInProgressPanel:function(){this.getEditorAPI().panelManager.openPanel("savePublish.panels.connectDomainInProgress",{connectedDomainURL:this.props.sitePublishedDomain,currentPublicURL:this.props.currentDomain},!0)},render:i})}),define("savePublish/panels/content/publishContent.rt",["react","lodash","savePublish/panels/content/generalContent"],function(e,t,n){return function(){return e.createElement(n,t.assign({},{className:this.getClassName()},this.getGeneralContentProps()))}}),define("savePublish/panels/content/publishContent",["react","core","panels","savePublish/panels/content/publishContent.rt"],function(e,t,n,s){return e.createClass({displayName:"publishContent",mixins:[t.mixins.editorAPIMixin],propTypes:{closePanel:e.PropTypes.func.isRequired,publishMethod:e.PropTypes.func.isRequired,className:e.PropTypes.string,actionCallback:e.PropTypes.func},getClassName:function(){return"publish-site-content"+(this.props.className?" "+this.props.className:"")},getGeneralContentProps:function(){return{symbolName:"publishSite",mainTitle:"SAVE_SITE_SAVED_WHATS_NEXT_LABEL",title:"SAVE_SITE_SAVED_WHATS_NEXT_PUBLISH_LINE",actionLabel:"SAVE_SITE_SAVED_WHATS_NEXT_PUBLISH_LINK",actionCallback:this.publishSite}},publishSite:function(){this.props.closePanel(),this.props.publishMethod(),this.props.actionCallback&&this.props.actionCallback()},render:s})}),define("savePublish/panels/save/siteWasSavedPanel",["react","lodash","core","util","savePublish/constants/constants","savePublish/constants/savePublishErrorPanelData","savePublish/panels/save/siteWasSavedPanel.rt","savePublish/panels/content/connectDomain","savePublish/panels/content/publishContent","coreUtilsLib"],function(e,t,n,s,i,a,o,r,l,c){function u(e){var t=e.lastIndexOf("/");return{prefix:e.slice(0,t+1),siteName:e.slice(t+1)}}var p={PUBLISH:"PUBLISH",CONNECT_DOMAIN:"CONNECT_DOMAIN"};return e.createClass({displayName:"siteWasSavedPanel",mixins:[e.addons.LinkedStateMixin,n.mixins.editorAPIMixin],propTypes:{domain:e.PropTypes.string.isRequired,isSitePremium:e.PropTypes.bool,isFirstSave:e.PropTypes.bool,isDomainConnected:e.PropTypes.bool,isSitePublished:e.PropTypes.bool,isMockSave:e.PropTypes.bool,overrideTitle:e.PropTypes.string,overrideSubtitle:e.PropTypes.string,callback:e.PropTypes.func},getInitialState:function(){var e={isContinueDisabled:!1,doNotShowAgain:null,domain:this.props.domain};if(!this.props.isFirstSave){var t=this.getEditorAPI().getUserPreferences();t&&(e.doNotShowAgain=!!t.session.get(n.constants.USER_PREFS.SAVE.SITE_SAVED_DONT_SHOW_AGAIN))}return e},getPanelTitle:function(){return s.translate(this.props.overrideTitle||"SAVE_SITE_SAVED_TITLE_TITLE")},getPanelSubtitle:function(){return s.translate(this.props.overrideSubtitle||"SAVE_SITE_SAVED_TITLE_SUBTITLE")},getDomainInputProps:function(){var e,t=this.state.domain;if(!this.props.isDomainConnected){var n=u(t);e={prefix:n.prefix,value:n.siteName,isEditable:!0,domainValidator:this.getEditorAPI().siteName.validate,domainHandler:this.props.isMockSave?null:this.renameSiteAndProcessResult,onChange:this.handleDomainEditingStatusChanged}}else e={value:t,isEditable:!1};return e.biHandler=this.domainInputBiReporter,e},getInnerPanelType:function(){return this.props.isSitePublished?this.props.isDomainConnected?void 0:p.CONNECT_DOMAIN:p.PUBLISH},getInnerPanel:function(){switch(this.getInnerPanelType()){case p.PUBLISH:return l;case p.CONNECT_DOMAIN:return r}},getPanelClass:function(){var e="site-was-saved-panel",t=this.getInnerPanelClass();return e+=t?" contains-"+t:"",this.props.isSitePremium&&this.props.isSitePublished&&this.props.isDomainConnected&&(e+=" narrow-domain-input"),e+" save-publish-panel"},getInnerPanelClass:function(){switch(this.getInnerPanelType()){case p.PUBLISH:return"publish-inner-panel";case p.CONNECT_DOMAIN:return"connect-domain-inner-panel"}},getInnerPanelProps:function(){var e={sitePublishedDomain:this.props.domain,isDomainConnected:this.props.isDomainConnected,isFirstPublish:!this.props.isSitePublished,isSitePremium:this.props.isSitePremium,isFirstSave:this.props.isFirstSave,flowId:n.constants.CONNECT_DOMAIN.FLOWS.SAVE,closePanel:this.close},t=this.getInnerPanelType(),s=this.getEditorAPI();switch(t){case p.PUBLISH:e.publishMethod=this.props.isMockSave?s.publishManager.configureMockPostPublish:s.publishManager.publish,this.props.isMockSave||(e.actionCallback=function(){this.reportPublishClickedBI(),this.getEditorAPI().bi.event(n.bi.events.publish.PUBLISH_CLICK,{origin:"saveSuccessPanel"})}.bind(this));break;case p.CONNECT_DOMAIN:this.props.isMockSave||(e.actionCallback=this.reportConnectDomainClickedBI)}return e},shouldDisplayInnerPanel:function(){return!this.props.isSitePublished||!this.props.isDomainConnected},continueToPublish:function(){this.props.isMockSave||(this.getEditorAPI().bi.event(n.bi.events.publish.PUBLISH_CLICK,{origin:"saveSuccessPanel"}),this.reportBIWithUserStatus(n.bi.events.save.siteWasSavedPanel.SECOND_SAVE_PUBLISH_NOW_BUTTON_CLICKED)),this.close(),this.getEditorAPI().publishManager.publish()},continueEditing:function(){if(this.props.isMockSave||(this.props.isFirstSave?this.getEditorAPI().bi.event(n.bi.events.save.siteWasSavedPanel.FIRST_SAVE_ACTION_BUTTON_CLICKED,{}):this.reportBIWithUserStatus(n.bi.events.save.siteWasSavedPanel.SECOND_SAVE_ACTION_BUTTON_CLICKED)),this.state.isContinueDisabled)throw new Error("Should not get to continueEditing if continue button is disabled");if(this.state.doNotShowAgain){var e=this.getEditorAPI().getUserPreferences();e?e.session.set(n.constants.USER_PREFS.SAVE.SITE_SAVED_DONT_SHOW_AGAIN,this.state.doNotShowAgain):c.log.error("siteWasSavedPanel tried to use userPreferences while they are not initialized")}this.close()},reportBIWithUserStatus:function(e){var t={user_status:this.getUserStatus()};this.getEditorAPI().bi.event(e,t)},getUserStatus:function(){var e="";return this.props.isSitePublished||(e+="not_"),e+="published_",this.props.isDomainConnected||(e+="not_"),e+="connected"},renameSiteAndProcessResult:function(e,n,s){var o=this.getEditorAPI();o.siteName.rename(e,function(){n()},function(e){var n=e&&e.errorCode;if(n===i.RENAME.ERRORS.SITE_NAME_TAKEN)s("SAVE_SITE_NAME_ALREADY_EXISTS");else{s();var r=t.chain(a.NAME_SITE_AGAIN_PANEL_DATA).clone().defaults(a.SAVE_ERROR_DEFAULT_PANEL_DATA).assign({errorCode:n}).value();o.panelManager.openPanel("savePublish.panels.common.failPanel",r,!0)}})},handleDomainEditingStatusChanged:function(e){var t={};if(e){var n=u(this.props.domain).prefix;t.isContinueDisabled=!1,t.domain=n+e}else t.isContinueDisabled=!0;this.setState(t)},handleNeedHelpConnectingDomainClicked:function(){this.getEditorAPI().bi.event(n.bi.events.save.siteWasSavedPanel.HELP_CONNECTING_DOMAIN_CLICKED,{})},handleDontShowAgainClicked:function(e){this.setState({doNotShowAgain:e}),this.getEditorAPI().bi.event(n.bi.events.save.siteWasSavedPanel.SECOND_SAVE_DONT_SHOW_AGAIN_CLICKED,{toggle:e,user_status:this.getUserStatus()})},reportPublishClickedBI:function(){this.getEditorAPI().bi.event(n.bi.events.save.siteWasSavedPanel.PUBLISH_NOW_CLICKED,{user_status:this.getUserStatus(),is_first_save:this.props.isFirstSave?1:0})},reportConnectDomainClickedBI:function(){this.getEditorAPI().bi.event(n.bi.events.save.siteWasSavedPanel.SECOND_SAVE_CONNECT_DOMAIN_CLICKED,{user_status:this.getUserStatus()})},domainInputBiReporter:function(e){if(!this.props.isMockSave){var t={user_status:this.getUserStatus(),panel_name:this.props.panelName,save_or_publish:"save",is_first_save_or_publish:this.props.isFirstSave?1:0};this.getEditorAPI().bi.event(n.bi.events.domainInput[e],t)}},componentWillUnmount:function(){this.props.callback&&this.props.callback()},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},getKeyboardShortcuts:function(){var e=this;return{enter:function(){e.state.isContinueDisabled||e.continueEditing()},esc:function(){e.close()}}},render:o})}),define("savePublish/panels/save/concurrentSavePanel.rt",["react","lodash","panels","baseUI","symbols","util"],function(e,t,n,s,i,a){return function(){return e.createElement(n.frames.confirmationPanelFrame,{panelName:this.props.panelName,className:"concurrent-save-panel save-publish-panel",panelTitle:a.translate(this.getTitle()),keyboardShortcuts:this.getKeyboardShortcuts(),confirmLabel:this.getConfirmLabel(),cancelLabel:this.getCancelLabel(),onConfirm:this.overrideSave,onCancel:this.handleCancel,onClose:this.close},e.createElement("div",{className:"content-wrapper"},e.createElement("div",{className:"error-logo"},e.createElement(s.symbol,{name:"plaster"})),this.isAutosave()?null:e.createElement("div",{key:"withoutAutosave",className:"description-wrapper"},e.createElement("span",{className:"description-line",dangerouslySetInnerHTML:{__html:a.translate("SAVE_PUBLISH_MULTIPLE_TABS_ERRROR_TOOLTIP_LINE1")}}),e.createElement("span",{className:"description-line",dangerouslySetInnerHTML:{__html:a.translate("SAVE_PUBLISH_MULTIPLE_TABS_ERRROR_TOOLTIP_LINE2")}})),this.isAutosave()?e.createElement("div",{key:"withAutosave",className:"description-wrapper"},e.createElement("div",{className:"description-line initialPadding",dangerouslySetInnerHTML:{__html:a.translate(this.getBodyText()[0])}}),e.createElement("div",{className:"description-line initialPadding",dangerouslySetInnerHTML:{__html:a.translate(this.getBodyText()[1])}}),e.createElement("div",{className:"description-line initialPadding",dangerouslySetInnerHTML:{__html:a.translate(this.getBodyText()[2])}})):null))}}),define("savePublish/panels/save/concurrentSavePanel",["react","core","savePublish/panels/save/concurrentSavePanel.rt","coreUtilsLib"],function(e,t,n,s){return e.createClass({displayName:"concurrentSavePanel",mixins:[t.mixins.editorAPIMixin],PropTypes:{overrideSaveMethod:e.PropTypes.func.isRequired,onCancel:e.PropTypes.func},isAutosave:function(){return"autosave"===this.props.origin},getTitle:function(){return this.isAutosave()?"AUTOSAVE_ERROR_CONCURRENT_EDITING_TITLE":"SAVE_PUBLISH_MULTIPLE_TABS_ERRROR_TOOLTIP_TITLE"},getBodyText:function(){return this.isAutosave()?["AUTOSAVE_ERROR_CONCURRENT_EDITING_DESCRIPTION_HEADER","AUTOSAVE_ERROR_CONCURRENT_EDITING_DESCRIPTION_OPTION1","AUTOSAVE_ERROR_CONCURRENT_EDITING_DESCRIPTION_OPTION2"]:["SAVE_PUBLISH_MULTIPLE_TABS_ERRROR_TOOLTIP_LINE1","SAVE_PUBLISH_MULTIPLE_TABS_ERRROR_TOOLTIP_LINE2"]},getConfirmLabel:function(){return this.isAutosave()?"AUTOSAVE_ERROR_CONCURRENT_EDITING_BUTTON_LABEL":"SAVE_ERROR_CONCURRENT_EDITING_SAVE_BUTTON"},getCancelLabel:function(){return this.isAutosave()?"AUTOSAVE_ERROR_CONCURRENT_EDITING_LINK_LABEL":"SAVE_ERROR_CONCURRENT_EDITING_DONT_SAVE_BUTTON"},overrideSave:function(){this.props.overrideSaveMethod?(this.props.overrideSaveMethod(this.getEditorAPI),this.sendBI("save")):s.log.info("Mock Overriding Save"),this.close()},handleCancel:function(){this.props.overrideSaveMethod&&this.sendBI(this.isAutosave()?"update":"don't save"),this.close(),this.props.onCancel&&this.props.onCancel()},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},sendBI:function(e){var n=t.bi.events.save.saveFailed,s=this.isAutosave()?n.CONCURRENT_AUTOSAVE:n.CONCURRENT_SAVE;this.getEditorAPI().bi.event(s,{selection:e})},getKeyboardShortcuts:function(){var e=this;return{esc:function(){e.close()}}},render:n})}),define("savePublish/panels/save/saveConfigurationPanel.rt",["react","lodash","panels","baseUI","baseUILib"],function(e,t,n,s,i){return function(){return e.createElement(n.frames.emptyPanelFrame,function(e,n){var s=t.assign({},e,n);return e.hasOwnProperty("style")&&(s.style=t.defaults(s.style,e.style)),e.hasOwnProperty("className")&&n.hasOwnProperty("className")&&(s.className=n.className+" "+e.className),s}({ref:"frame",className:"save-configuration-panel"},this.getFrameProps()),e.createElement("a",{className:"close-button",onClick:this.close},"x"),e.createElement("h2",{style:{textAlign:"center"}},"Save Testing Configuration"),e.createElement(i.Checkbox,{className:"checkbox-field",label:"First save",valueLink:this.linkState("isFirstSave"),shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(i.Checkbox,{className:"checkbox-field",label:"Save succeeds",valueLink:this.linkState("shouldSaveSucceed"),shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement("p",{},e.createElement("br",{}),"Premium Interaction:"),e.createElement(i.Checkbox,{className:"checkbox-field",label:"Site is/upgraded-to premium",value:this.state.isSitePremium,onChange:this.premiumToggled,shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(i.Checkbox,{className:"checkbox-field",label:"Domain is/will-be connected",value:this.state.isDomainConnected,onChange:this.domainConnectedToggled,shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(s.textInput,{className:"domain-text-field",shouldTranslate:!1,label:"Custom Domain",valueLink:this.linkState("domain"),disabled:!this.state.isDomainConnected}),e.createElement(i.Checkbox,{className:"checkbox-field"+(this.state.isFirstSave?" disabled":""),label:"Site is published",valueLink:this.linkState("isSitePublished"),disabled:this.state.isFirstSave,shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement("button",{className:"concurrent-save-button",shouldTranslate:!1,onClick:this.openConcurrentSave},"Concurrent Save"),e.createElement("button",{className:"save-reminder-button",shouldTranslate:!1,onClick:this.openSaveReminder},"Save Reminder"),e.createElement("div",{className:"save-configuration-footer"},e.createElement(s.button,{className:"confirm-button",shouldTranslate:!1,label:"Start Save",onClick:this.onConfirm})))}}),define("savePublish/panels/save/saveConfigurationPanel",["react","core","savePublish/panels/save/saveConfigurationPanel.rt","coreUtilsLib"],function(e,t,n,s){return e.createClass({displayName:"SaveConfigurationPanel",mixins:[e.addons.LinkedStateMixin,t.mixins.editorAPIMixin],propTypes:{onConfirm:e.PropTypes.func.isRequired},getInitialState:function(){return{isSitePremium:!1,isFirstSave:!0,isDomainConnected:!1,domain:"http://www.my-domain.com",isSitePublished:!1,shouldSaveSucceed:!0}},getFrameProps:function(){return{panelName:this.props.panelName}},openConcurrentSave:function(){this.getEditorAPI().panelManager.openPanel("savePublish.panels.save.concurrentSavePanel",{overrideSaveMethod:function(){s.log.info("Override Save")}},!0)},openSaveReminder:function(){this.getEditorAPI().panelManager.openPanel("savePublish.panels.save.saveReminderPanel",{saveMethod:this.onConfirm},!0)},componentWillUpdate:function(e,t){t.isFirstSave&&t.isSitePublished&&this.setState({isSitePublished:!1,isFirstSave:!0})},premiumToggled:function(){var e=!this.state.isSitePremium;this.setState({isSitePremium:e,isDomainConnected:!!e&&this.state.isDomainConnected})},domainConnectedToggled:function(){var e=!this.state.isDomainConnected;this.setState({isDomainConnected:e,isSitePremium:e||this.state.isSitePremium})},onConfirm:function(){this.props.onConfirm({isSitePremium:this.state.isSitePremium,isFirstSave:this.state.isFirstSave,isDomainConnected:this.state.isDomainConnected,domain:this.state.domain,isSitePublished:this.state.isSitePublished,shouldSaveSucceed:this.state.shouldSaveSucceed})},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},render:n})}),define("savePublish/panels/save/saveReminderPanel.rt",["react","lodash","util","baseUI","panels","experiment"],function(e,t,n,s,i,a){return function(){return a.isOpen("disableSaveReminder")?null:e.createElement(i.frames.messagePanelFrame,{ref:"frame",key:"saveReminder",panelName:this.props.panelName,className:"save-reminder-panel save-publish-panel",panelTitle:n.translate("SAVE_REMINDER_MSG_TITLE"),confirmLabel:"SAVE_REMINDER_MSG_BUTTON",onConfirm:this.handleSave,keyboardShortcuts:this.getKeyboardShortcuts()},e.createElement("div",{className:"content-wrapper"},e.createElement("div",{className:"icon"},e.createElement(s.symbol,{name:"saveYourWork"})),e.createElement("div",{className:"message"},n.translate("SAVE_REMINDER_MSG_BODY"))))}}),define("savePublish/panels/save/saveReminderPanel",["react","lodash","core","savePublish/panels/save/saveReminderPanel.rt"],function(e,t,n,s){return e.createClass({displayName:"saveReminderPanel",mixins:[n.mixins.editorAPIMixin],propTypes:{saveMethod:e.PropTypes.func.isRequired},componentWillMount:function(){this.getEditorAPI().bi.event(n.bi.events.save.saveReminder.REMINDER_DISPLAYED,{origin:"pop up message"})},handleSave:function(){this.getEditorAPI().bi.event(n.bi.events.save.saveReminder.SAVE_CLICKED,{}),this.close(),this.props.saveMethod()},getKeyboardShortcuts:function(){var e=this;return{enter:function(){e.close(),e.handleSave()},esc:function(){e.close()}}},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},render:s})}),define("savePublish/panels/save/onBoardingMigrationConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,t,n,s){return function(){return e.createElement(n.frames.focusPanelFrame,{ref:"frame",key:"onBoardingMigrationConfirmationPanel",shouldHideHelp:!0,className:"save-on-boarding-site-confirm-panel",title:this.translateIfNeeded("ADI_EDITOR_MIGRATION_SAVEPOPUP_TITLE"),panelName:this.props.panelName},e.createElement("div",{className:"save-on-boarding-site-confirm-content"},e.createElement("div",{className:"image-container"},e.createElement(s.symbol,{name:"obMigrationBeforeSave"})),e.createElement("div",{className:"description-container"},e.createElement("span",{className:"description-text"},this.translateIfNeeded("ADI_EDITOR_MIGRATION_SAVEPOPUP_TEXT"))),e.createElement("div",{className:"footer-buttons"},e.createElement(s.button,{onClick:this.navigateToOnBoarding,className:"btn-confirm-secondary btn-md footer-button",label:"ADI_EDITOR_MIGRATION_SAVEPOPUP_BUTTON_ADI"}),e.createElement(s.button,{onClick:this.saveDocument,className:"btn-confirm-primary btn-md footer-button",label:"ADI_EDITOR_MIGRATION_SAVEPOPUP_BTN_SAVE"}))))}}),define("savePublish/panels/save/onBoardingMigrationConfirmationPanel",["react","util","core","savePublish/panels/save/onBoardingMigrationConfirmationPanel.rt"],function(e,t,n,s){function i(e,t){e.bi.event(n.bi.events.ON_BOARDING_MIGRATION.PANEL_ACTION_CLICKED,{action:t})}var a={NAVIGATE_TO_OB:"Go Back to Wix ADI",SAVE:"Save Changes"};return e.createClass({displayName:"onBoardingMigrationConfirmationPanel",propTypes:{panelName:e.PropTypes.string.isRequired,onConfirm:e.PropTypes.func.isRequired},mixins:[t.translationMixin,n.mixins.editorAPIMixin],saveDocument:function(){i(this.getEditorAPI(),a.SAVE),this.props.onConfirm(),this.close()},navigateToOnBoarding:function(){i(this.getEditorAPI(),a.NAVIGATE_TO_OB),window.location=t.editorModel.onboardingEditorUrl},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},render:s})}),define("savePublish/panels/save/saveYourSitePanel.rt",["react","lodash","util","baseUI","panels"],function(e,t,n,s,i){return function(){return e.createElement(i.frames.messagePanelFrame,{ref:"frame",panelName:this.props.panelName,className:"save-your-site-panel",panelTitle:n.translate(this.props.title),confirmLabel:"TOPBAR_SETTINGS_BUTTON_SAVE",onConfirm:this.handleSave,keyboardShortcuts:this.keyboardShortcuts},e.createElement("div",{className:"content-wrapper"},e.createElement("div",{className:"logo"},e.createElement(s.symbol,{name:"saveYourWork"})),e.createElement("div",{className:"message"},n.translate(this.props.messageBody))))}}),define("savePublish/panels/save/saveYourSitePanel",["react","lodash","core","savePublish/panels/save/saveYourSitePanel.rt"],function(e,t,n,s){return e.createClass({displayName:"saveYourSitePanel",mixins:[n.mixins.editorAPIMixin],propTypes:{title:e.PropTypes.string.isRequired,messageBody:e.PropTypes.string.isRequired},getInitialState:function(){return this.keyboardShortcuts={enter:this.handleSave,esc:this.close},{}},handleSave:function(){this.close(),this.getEditorAPI().saveManager.save()},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},render:s})}),define("savePublish/panels/save/savePanels",["savePublish/panels/save/chooseDomainPanel","savePublish/panels/save/siteWasSavedPanel","savePublish/panels/save/concurrentSavePanel","savePublish/panels/save/saveConfigurationPanel","savePublish/panels/save/saveReminderPanel","savePublish/panels/save/onBoardingMigrationConfirmationPanel","savePublish/panels/save/saveYourSitePanel"],function(e,t,n,s,i,a,o){return{chooseDomainPanel:e,siteWasSavedPanel:t,concurrentSavePanel:n,saveConfigurationPanel:s,saveReminderPanel:i,onBoardingMigrationConfirmationPanel:a,saveYourSitePanel:o}}),define("savePublish/panels/publish/config/publishConfigurationPanel.rt",["react","lodash","panels","baseUI","baseUILib"],function(e,t,n,s,i){return function(){return e.createElement(n.frames.emptyPanelFrame,{className:"save-configuration-panel",panelName:this.props.panelName},e.createElement("a",{className:"close-button",onClick:this.close},"x"),e.createElement("h2",{style:{textAlign:"center"}},"Publish Testing Configuration"),e.createElement(i.Checkbox,{className:"checkbox-field",label:"Is Contributor to site",valueLink:this.linkState("isSiteContributor"),shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(i.Checkbox,{className:"checkbox-field",label:"Did Publish Succeed",valueLink:this.linkState("shouldPublishSucceed"),shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(i.Checkbox,{className:"checkbox-field",label:"Site is Premium",valueLink:this.linkState("isPremiumUser"),shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(i.Checkbox,{className:"checkbox-field",label:"First Publish",valueLink:this.linkState("isFirstPublish"),shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(i.Checkbox,{className:"checkbox-field",label:"Is Domain Connected",valueLink:this.linkState("isDomainConnected"),shouldTranslate:!1,labelAfterSymbol:!0}),e.createElement(s.textInput,{className:"domain-text-field",shouldTranslate:!1,label:"Site address (Domain Name)",valueLink:this.linkState("sitePremiumDomain")}),e.createElement(s.button,{className:"confirm-button",disabled:!this.state.isPremiumUser&&this.state.isDomainConnected&&this.state.shouldPublishSucceed,shouldTranslate:!1,label:"Start Publish",onClick:this.onConfirm}))}}),define("savePublish/panels/publish/config/publishConfigurationPanel",["react","core","savePublish/panels/publish/config/publishConfigurationPanel.rt"],function(e,t,n){return e.createClass({displayName:"publishConfigurationPanel",mixins:[e.addons.LinkedStateMixin,t.mixins.editorAPIMixin],propTypes:{onConfirm:e.PropTypes.func.isRequired},getInitialState:function(){return{isSiteContributor:!1,isFirstPublish:!0,isDomainConnected:!1,isPremiumUser:!0,shouldPublishSucceed:!0,sitePremiumDomain:"http://www.published-site-domain.com"}},onConfirm:function(){this.props.onConfirm({isSiteContributor:this.state.isSiteContributor,isFirstPublish:this.state.isFirstPublish,isDomainConnected:this.state.isDomainConnected,sitePremiumDomain:this.state.sitePremiumDomain,isPremiumUser:this.state.isPremiumUser,shouldPublishSucceed:this.state.shouldPublishSucceed})},close:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},render:n})}),define("savePublish/panels/publish/content/postPublishPromotePanel.rt",["react","lodash","baseUILib","baseUI"],function(e,t,n,s){return function(){function i(t,n){return e.createElement("div",{className:"promote"},t.symbol?e.createElement("div",{key:"promotionSymbol-"+t.key,className:"promote-symbol promote-symbol-"+t.key},e.createElement(s.symbol,{name:t.symbol})):null,t.img&&!t.symbol?e.createElement("div",{key:"promotionImg-"+t.key,className:"promote-image",style:{backgroundImage:"url("+t.img+")"}}):null,e.createElement("div",{className:"description"},t.description),e.createElement("a",{onClick:t.action},t.actionTitle))}return e.createElement("div",{className:"panel-shout-out"},e.createElement("div",{className:"promote-title-wrapper"},e.createElement(n.Divider,{long:!0}),e.createElement("div",{className:"promote-title"},this.getTitle()),e.createElement(n.Divider,{long:!0})),e.createElement.apply(this,["div",{className:"promotion-content"},t.map(this.getPanelContent(),i.bind(this))]))}}),define("savePublish/panels/publish/content/shoutoutPanel",["lodash","react","core","util","experiment","savePublish/panels/publish/content/postPublishPromotePanel.rt"],function(e,t,n,s,i,a){return t.createClass({displayName:"shoutoutPanel",mixins:[n.mixins.editorAPIMixin],propTypes:{isUserPremium:t.PropTypes.bool,languageCode:t.PropTypes.string,metaSiteId:t.PropTypes.string.isRequired,sitePublicUrl:t.PropTypes.string,siteNameSEO:t.PropTypes.string,siteDescriptionSEO:t.PropTypes.string,isFirstPublish:t.PropTypes.bool,userStatus:t.PropTypes.string},getTitle:function(){return s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_TITLE")},getPanelContent:function(){var e={key:"facebook",symbol:"publishFacebook",description:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_1_TITLE"),actionTitle:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_1_LINK"),action:this.openFacebook},t={key:"seo",symbol:"publishSeo",description:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_SEO_TITLE"),actionTitle:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_SEO_LINK"),action:this.openSeoWizard},n={key:"twitter",symbol:"publishTwitter",description:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_2_TITLE"),actionTitle:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_2_LINK"),action:this.openTwitter},a={key:"shoutout",symbol:"publishShoutout",description:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_3_TITLE"),actionTitle:s.translate("PUBLISH_CONGRATULATIONS_WHATS_NEXT_3_LINK"),action:this.openShoutout};return this.getEditorAPI().account.isWixSEOWizExperimentOpen()&&i.isOpen("se_seoWizard")?[t,n,a]:[e,n,a]},openFacebook:function(){this.sendSecondPublishBI(n.bi.events.publish.Second_Publish_facebook_Share_click),n.utils.social.openFacebook(this.props.sitePublicUrl,this.props.languageCode,this.props.siteNameSEO,this.props.siteDescriptionSEO)},openSeoWizard:function(){this.sendSecondPublishBI(n.bi.events.publish.Second_Publish_Seo_Wizard_click),this.getEditorAPI().account.openWixSEOWiz("EDITOR_POSTPUBLISH")},openTwitter:function(){this.sendSecondPublishBI(n.bi.events.publish.Second_Publish_Twitter_share_click),n.utils.social.openTwitter(this.props.sitePublicUrl,this.props.isUserPremium)},openShoutout:function(){this.sendSecondPublishBI(n.bi.events.publish.Second_Publish_ShoutOut_Share_click),n.utils.social.openShoutout(this.props.metaSiteId)},sendSecondPublishBI:function(e){!this.props.isFirstPublish&&this.props.userStatus&&this.getEditorAPI().bi.event(e,{user_status:this.props.userStatus})},render:a})}),define("savePublish/panels/publish/content/growBusinessPanel",["react","core","util","savePublish/panels/publish/content/postPublishPromotePanel.rt"],function(e,t,n,s){return e.createClass({displayName:"growBusinessPanel",mixins:[t.mixins.editorAPIMixin],propTypes:{metaSiteId:e.PropTypes.string.isRequired,isFirstPublish:e.PropTypes.bool,userStatus:e.PropTypes.string},getTitle:function(){return n.translate("PUBLISH_CONGRATULATIONS_NEXT_PROMOTE_TITLE")},getPanelContent:function(){return[{key:"newsletter",symbol:"publishShoutout",description:n.translate("PUBLISH_CONGRATULATIONS_NEXT_PROMOTE_1_TITLE"),actionTitle:n.translate("PUBLISH_CONGRATULATIONS_NEXT_PROMOTE_1_LINK"),action:this.openShoutout},{key:"mail",symbol:"promoteMail",description:n.translate("PUBLISH_CONGRATULATIONS_NEXT_PROMOTE_2_TITLE"),actionTitle:n.translate("PUBLISH_CONGRATULATIONS_NEXT_PROMOTE_2_LINK"),action:this.getYourOwnMailbox},{key:"traffic",symbol:"promoteContact",description:n.translate("PUBLISH_CONGRATULATIONS_NEXT_PROMOTE_3_TITLE"),actionTitle:n.translate("PUBLISH_CONGRATULATIONS_NEXT_PROMOTE_3_LINK"),action:this.getTrafficApps}]},openShoutout:function(){this.sendPublishBI(t.bi.events.publish.First_Publish_Send_ShoutOut_link_click,t.bi.events.publish.Second_Publish_ShoutOut_Share_click),t.utils.social.openShoutout(this.props.metaSiteId)},getYourOwnMailbox:function(){this.sendPublishBI(t.bi.events.publish.First_Publish_get_own_Mailbox_link_click,t.bi.events.publish.Second_Publish_get_own_Mailbox_click),window.open("https://premium.wix.com/wix/api/googleMailBoxConsole?referralAdditionalInfo=da_quick_actions")},getTrafficApps:function(){this.sendPublishBI(t.bi.events.publish.First_Publish_Traffic_Apps_link_click,t.bi.events.publish.Second_Publish_Traffic_Apps_click);var e=["http://www.wix.com/my-account/sites/",this.props.metaSiteId,"/apps/all?referralInfo=premium_publish"].join("");window.open(e)},sendPublishBI:function(e,t){this.props.isFirstPublish&&this.props.userStatus?this.getEditorAPI().bi.event(e,{user_status:this.props.userStatus}):!this.props.isFirstPublish&&this.props.userStatus&&this.getEditorAPI().bi.event(t,{user_status:this.props.userStatus})},render:s})}),define("savePublish/panels/content/musicPromoContent.rt",["react","lodash","savePublish/panels/content/generalContent"],function(e,t,n){return function(){return e.createElement(n,function(e,n){var s=t.assign({},e,n);return e.hasOwnProperty("style")&&(s.style=t.defaults(s.style,e.style)),e.hasOwnProperty("className")&&n.hasOwnProperty("className")&&(s.className=n.className+" "+e.className),s}({className:"music-promo-content "+this.props.className},this.getGeneralContentProps()))}}),define("savePublish/panels/content/musicPromoContent",["react","lodash","core","util","staticAssets","savePublish/panels/content/musicPromoContent.rt"],function(e,t,n,s,i,a){return e.createClass({displayName:"musicPromoContent",propTypes:{className:e.PropTypes.string,closePanel:e.PropTypes.func.isRequired},mixins:[n.mixins.editorAPIMixin],getGeneralContentProps:function(){var e,t;return s.browserUtil.getDevicePixelRatio()>=2?(e=s.media.getMediaUrl(i.staticAssetsMap["savePublish/panels/content/musicPromotionRetina.png"]),t={width:110.5}):e=s.media.getMediaUrl(i.staticAssetsMap["savePublish/panels/content/musicPromotion.png"]),{className:"",imageSrc:e,imageStyle:t,mainTitle:s.translate("SAVE_SITE_SAVED_WHATS_NEXT_LABEL"),title:s.translate("MUSIC_PROMOTION_PUBLISH_WHATS_NEXT_TITLE"),subtitle:s.translate("MUSIC_PROMOTION_PUBLISH_WHATS_NEXT_BODY1"),actionLabel:s.translate("MUSIC_PROMOTION_PUBLISH_WHATS_NEXT_BUTTON"),shouldTranslate:!1,actionCallback:this.handleActionClicked}},handleActionClicked:function(){var e=n.bi.events.musicPromotionPopup.submit_video_clicked,t={origin:"post-publish-link"};this.getEditorAPI().bi.event(e,t);var i=s.translate("MUSIC_PROMOTION_PUBLISH_WHATS_NEXT_BUTTON_URL");this.props.closePanel(),window.open(i)},render:a})}),define("savePublish/panels/content/photographyPromoContent.rt",["react","lodash","savePublish/panels/content/generalContent"],function(e,t,n){return function(){return e.createElement(n,function(e,n){var s=t.assign({},e,n);return e.hasOwnProperty("style")&&(s.style=t.defaults(s.style,e.style)),e.hasOwnProperty("className")&&n.hasOwnProperty("className")&&(s.className=n.className+" "+e.className),s}({className:"photo-promo-content "+this.props.className},this.getGeneralContentProps()))}}),define("savePublish/panels/content/photographyPromoContent",["react","lodash","core","util","staticAssets","savePublish/panels/content/photographyPromoContent.rt"],function(e,t,n,s,i,a){return e.createClass({displayName:"photographyPromoContent",propTypes:{className:e.PropTypes.string,closePanel:e.PropTypes.func.isRequired},mixins:[n.mixins.editorAPIMixin],getGeneralContentProps:function(){var e,t;return s.browserUtil.getDevicePixelRatio()>=2?(e=s.media.getMediaUrl(i.staticAssetsMap["savePublish/panels/content/photoPromotionRetina.gif"]),t={width:"100%"}):e=s.media.getMediaUrl(i.staticAssetsMap["savePublish/panels/content/photoPromotion.gif"]),{className:"",imageSrc:e,imageStyle:t,mainTitle:s.translate("SAVE_SITE_SAVED_WHATS_NEXT_LABEL"),title:s.translate("PHOTO_PROMO_PUBLISH_HEADER"),subtitle:s.translate("PHOTO_PROMO_PUBLISH_TEXT"),actionLabel:s.translate("PHOTO_PROMO_PUBLISH_CTA"),shouldTranslate:!1,actionCallback:this.handleActionClicked}},handleActionClicked:function(){var e=n.bi.events.photographyPromotionPopup.submit_video_clicked,t={origin:"post-publish-link"};this.getEditorAPI().bi.event(e,t);var i=s.translate("PHOTO_PROMO_PUBLISH_CTA_URL");this.props.closePanel(),window.open(i)},render:a})}),define("savePublish/panels/publish/publishSuccessPanel.rt",["react","lodash","panels","util","baseUI","baseUILib","symbols"],function(e,t,n,s,i,a,o){return function(){function r(e,n){var s=t.assign({},e,n);return e.hasOwnProperty("style")&&(s.style=t.defaults(s.style,e.style)),e.hasOwnProperty("className")&&n.hasOwnProperty("className")&&(s.className=n.className+" "+e.className),s}function l(){var t=this.getInnerPanel();return e.createElement(n.frames.focusPanelFrame,r({className:this.getFrameClass(),frameClassName:"save-publish-panel-frame",keyboardShortcuts:this.getShortcuts()},this.getFrameProps()),e.createElement("header",{className:"save-publish-panel-header"},e.createElement("button",{className:"close",onClick:this.props.closePanel},e.createElement(o.symbol,{name:"headerCloseButton"})),e.createElement("span",{className:"title"},s.translate("PUBLISH_CONGRATULATIONS_TITLE_TITLE")),e.createElement("span",{className:"subtitle"},s.translate("PUBLISH_CONGRATULATIONS_TITLE_SUBTITLE"))),e.createElement("div",{className:"address-bar-wrapper"},e.createElement("span",{className:"address"},e.createElement(i.domainInput,{value:this.getSiteUrl(),isEditable:!1,biHandler:this.domainInputBiReporter})),e.createElement(i.button,{className:"view-site-button",label:"SAVE_PUBLISH_BUTTON_VIEW",onClick:this.viewYourSite})),null!==t?e.createElement("div",{key:"innerPanel",className:"publish-inner-panel"},t):null,e.createElement("div",{className:"publish-success-footer"},this.isDontShowAgainCheckboxVisible()&&null!==t?e.createElement(a.Checkbox,{key:"dontShowAgain",className:"dont-show-again",label:"SAVE_PUBLISH_DO_NOT_SHOW_AGAIN_LABEL",value:this.state.dontShowAgain,onChange:this.toggleDontShowAgain,labelAfterSymbol:!0}):null,e.createElement("div",{className:"footer-buttons"},this.isSecondaryButtonDisplayed()?e.createElement(i.button,{key:"secondaryFooterButton",className:"btn-confirm-secondary",label:this.getSecondaryButtonText(),onClick:this.handleSecondaryButtonClicked}):null,e.createElement(i.button,{className:"btn-confirm-primary",label:this.getPrimaryButtonText(),onClick:this.handlePrimaryButtonClicked}))))}return l.apply(this,[])}}),define("savePublish/panels/publish/publishSuccessPanel",["react","lodash","core","savePublish/panels/publish/publishInnerPanelTypes","savePublish/panels/publish/content/shoutoutPanel","savePublish/panels/publish/content/growBusinessPanel","savePublish/panels/content/connectDomain","savePublish/panels/content/musicPromoContent","savePublish/panels/content/photographyPromoContent","savePublish/panels/publish/publishSuccessPanel.rt","experiment"],function(e,t,n,s,i,a,o,r,l,c,u){return e.createClass({displayName:"publishSuccessPanel",mixins:[e.addons.LinkedStateMixin,n.mixins.editorAPIMixin],propTypes:{isFakePanel:e.PropTypes.bool,contentPanelType:function(e,n,i){if(!e[n]||!t.some(s,e[n]))return new Error("Invalid prop `"+n+"` supplied to "+i+". Validation failed.")},configuration:e.PropTypes.object.isRequired,currentDomain:e.PropTypes.string.isRequired,userPreferences:e.PropTypes.object,sitePublicUrl:e.PropTypes.string.isRequired,closePanel:e.PropTypes.func.isRequired},componentDidMount:function(){this.sendPanelMountedBI()},getInitialState:function(){return{dontShowAgain:!1}},getShortcuts:function(){return{esc:this.onClose,enter:this.handlePrimaryButtonClicked}},onClose:function(){this.getEditorAPI().panelManager.closePanelByName(this.props.panelName)},getFrameProps:function(){return{panelName:this.props.panelName,shouldHideHeader:!0}},getInnerContentClass:function(){if(this.props.contentPanelType===s.EMPTY)return null;switch(this.props.contentPanelType.name){case s.SHOUTOUT.name:return"grow-business-inner-panel";case s.CONNECT_DOMAIN.name:return"connect-domain-inner-panel";case s.GROW_BUSINESS.name:return"grow-business-inner-panel";case s.MUSIC_PROMO.name:return"music-promo-inner-panel";case s.PHOTOGRAPHY_PROMO.name:return"photo-promo-inner-panel";default:return""}},getFrameClass:function(){var e="publish-success-panel save-publish-panel",t=this.getInnerContentClass();return e+=t?" contains-"+t:""},onDoneAndBI:function(e){this.sendActionButtonClickedBI(e),this.onDone()},onDone:function(){if(this.state.dontShowAgain||this.props.isFakePanel){var e=this.props.contentPanelType.userPref;if(e){var t=this.state.dontShowAgain;this.setDontShowPanelValue(e,t)}}this.props.closePanel()},isDontShowAgainCheckboxVisible:function(){return!this.props.configuration.isFirstPublish&&!t.isEqual(this.props.contentPanelType,s.EMPTY)},isSecondaryButtonDisplayed:function(){return u.isOpen("publishUpgradeButtons")&&!this.props.configuration.isDomainConnected&&this.props.contentPanelType.name===s.CONNECT_DOMAIN.name},setDontShowPanelValue:function(e,t){e&&this.props.userPreferences.session.set(e,t)},viewYourSite:function(){this.sendViewSiteBI();var e=this.getEditorAPI().site.getSitePublicUrl();this.props.configuration.isDomainConnected&&(e=this.props.configuration.sitePremiumDomain),window.open(e)},getSiteUrl:function(){var e=/(?:^https?:\/\/)?(?:www\.)?(.*)/i;return(this.props.configuration.sitePremiumDomain||this.props.sitePublicUrl).replace(e,this.getEditorAPI().domain.getSiteProtocol()+(this.getEditorAPI().domain.isDomainConnected()?"://www.$1":"://$1"))},getInnerPanel:function(){if(this.props.contentPanelType===s.EMPTY)return null;var t=null,n=null;switch(this.props.contentPanelType.name){case s.SHOUTOUT.name:t=i,n=this.getShoutoutPanelProps();break;case s.CONNECT_DOMAIN.name:t=o,n=this.getConnectDomainPanelProps(this.props.configuration);break;case s.GROW_BUSINESS.name:t=a,n={metaSiteId:this.getEditorAPI().documentServices.generalInfo.getMetaSiteId(),userStatus:this.getUserStatus(),isFirstPublish:this.props.configuration.isFirstPublish};break;case s.MUSIC_PROMO.name:t=r,n={closePanel:this.onDone};break;case s.PHOTOGRAPHY_PROMO.name:t=l,n={closePanel:this.onDone}}return t?e.createElement(t,n):null},getShoutoutPanelProps:function(){var e=this.getEditorAPI();return{isUserPremium:this.props.configuration.isPremiumUser,languageCode:e.getLanguageCode(),metaSiteId:e.documentServices.generalInfo.getMetaSiteId(),sitePublicUrl:this.props.sitePublicUrl,siteNameSEO:e.site.getSEOSiteName(),siteDescriptionSEO:e.site.getSEOSiteDescription(),userStatus:this.getUserStatus(),isFirstPublish:this.props.configuration.isFirstPublish}},getConnectDomainPanelProps:function(e){return{isFirstPublish:e.isFirstPublish,isDomainConnected:e.isDomainConnected,currentDomain:this.props.sitePublicUrl,sitePublishedDomain:e.sitePremiumDomain,isSitePremium:e.isPremiumUser,isFirstSave:e.isFirstSave,closePanel:this.onDone,flowId:n.constants.CONNECT_DOMAIN.FLOWS.PUBLISH,actionCallback:this.sendConnectDomainClickedBI}},getPrimaryButtonText:function(){return this.isSecondaryButtonDisplayed()?this.props.configuration.isPremiumUser?"Save_Publish_POST_CONNECT_NOW":(u.isOpen("spanishUpgradeText"),"Save_Publish_POST_UPGRADE_NOW"):"SAVE_PUBLISH_BUTTON_DONE"},getSecondaryButtonText:function(){return"Save_Publish_POST_CONNECT_LATER"},handlePrimaryButtonClicked:function(){var e=this.props.configuration.isFirstPublish,t=n.bi.events.publish,s=e?t.First_Publish_Done_click:t.Second_Publish_Done_click;if(this.isSecondaryButtonDisplayed())if(this.isConnectDomainInProgress())this.openConnectDomainInProgressPanel(),s=t.publish_flow_connect_domain_now_button_click;else if(this.props.configuration.isPremiumUser)this.getEditorAPI().account.openConnectDomain(n.constants.CONNECT_DOMAIN.FLOWS.PUBLISH_BUTTON,e),s=t.publish_flow_connect_domain_now_button_click;else{var i="edhtml_PUBLISH_FLOW_UPGRADE_BUTTON_"+(e?"FIRST_PUBLISH":"SECOND_PUBLISH");this.getEditorAPI().account.upgrade(i),s=t.publish_flow_upgrade_now_button_click}this.onDoneAndBI(s)},handleSecondaryButtonClicked:function(){var e=this.props.configuration.isFirstPublish,t=n.bi.events.publish,s=e?t.First_Publish_Done_click:t.Second_Publish_Done_click;this.isSecondaryButtonDisplayed()&&(s=this.props.configuration.isPremiumUser?t.publish_flow_connect_domain_later_button_click:t.publish_flow_upgrade_later_button_click),this.onDoneAndBI(s)},isConnectDomainInProgress:function(){var e=this.props.configuration.sitePremiumDomain,n=this.props.configuration.isDomainConnected,s=this.props.configuration.isPremiumUser,i=!t.isEmpty(e)&&!t.includes(e,"wix.com");return s&&i&&!n},openConnectDomainInProgressPanel:function(){this.getEditorAPI().panelManager.openPanel("savePublish.panels.connectDomainInProgress",{connectedDomainURL:this.props.configuration.sitePremiumDomain,currentPublicURL:this.props.sitePublicUrl},!0)},sendPanelMountedBI:function(){var e=n.bi.events.publish.publish_success_panel_opened_with_content,t={is_first_publish:this.props.configuration.isFirstPublish,message:this.props.contentPanelType.name};this.sendBI(e,t)},sendConnectDomainClickedBI:function(){var e=null,t=null;e=this.props.configuration.isFirstPublish?n.bi.events.publish.First_Publish_connect_domain_click:n.bi.events.publish.Second_Publish_connect_domain_click,this.props.configuration.isSitePremium&&!this.props.configuration.isDomainConnected?t={user_status:"Not Connected Premium"}:this.props.configuration.isSitePremium||(t={user_status:"free user"}),e.fields.message&&(t.message=this.props.contentPanelType.name),e&&t&&this.sendBI(e,t)},sendActionButtonClickedBI:function(e){var t=this.props.configuration.isFirstPublish,n={user_status:this.getUserStatus()};e.fields.is_first_publish&&(n.is_first_publish=t),e.fields.message&&(n.message=this.props.contentPanelType.name),this.sendBI(e,n)},sendViewSiteBI:function(){this.sendBI(n.bi.events.publish.publish_view_your_site_click,{is_first_publish:this.props.configuration.isFirstPublish?1:0,panel_name:"savePublish.panels.publish.publishSuccessPanel",user_status:this.getUserStatus()})},getUserStatus:function(){var e=this.props.configuration.isPremiumUser,t=this.props.configuration.isDomainConnected,n=null;return e?e&&t?n="Connected Premium":e&&!t&&(n="Not Connected Premium"):n="free user",n},toggleDontShowAgain:function(){var e=!this.state.dontShowAgain;this.sendToggleDontShowAgainBI(e),this.setState({dontShowAgain:e})},sendToggleDontShowAgainBI:function(e){e=e?1:0,this.props.configuration.isFirstPublish?this.sendBI(n.bi.events.publish.First_Publish_dont_show_again_click,{toggle:e,user_status:this.getUserStatus()}):this.sendBI(n.bi.events.publish.Second_Publish_dont_show_again_click,{toggle:e})},domainInputBiReporter:function(e){var t={user_status:this.getUserStatus(),panel_name:this.props.panelName,save_or_publish:"publish",is_first_save_or_publish:this.props.configuration.isFirstPublish?1:0};this.sendBI(n.bi.events.domainInput[e],t)},sendBI:function(e,t){this.getEditorAPI().bi.event(e,t)},render:c})}),define("savePublish/panels/publish/publishPanels",["savePublish/panels/publish/config/publishConfigurationPanel","savePublish/panels/publish/publishSuccessPanel","savePublish/panels/publish/content/shoutoutPanel"],function(e,t,n){return{config:{publishConfigurationPanel:e},publishSuccessPanel:t,shoutOut:n}}),define("savePublish",["lodash","savePublish/managers/saveManager","savePublish/managers/autosaveManager","savePublish/managers/mockSaveManager","savePublish/managers/publishManager","savePublish/panels/connectDomain/connectDomainPanel","savePublish/panels/connectDomain/connectDomainInProgress","savePublish/panels/common/commonPanels","savePublish/panels/save/savePanels","savePublish/panels/publish/publishPanels"],function(e,t,n,s,i,a,o,r,l,c){return{createSaveManager:t,createPublishManager:i,createAutosaveManager:n,configureSave:s.save,panels:{connectDomain:a,connectDomainInProgress:o,common:r,publish:c,save:l}}});
//# sourceMappingURL=savePublish.min.js.map