"use strict";define("platform/common/constants",[],function(){return{EDITOR_API_NS:"editorAPI",PLATFORM_PANEL:"PLATFORM_PANEL",PLATFORM_ON_EVENT:"PLATFORM_ON_EVENT",PLATFORM_SDK_ALIVE:"PLATFORM_SDK_ALIVE",PLATFORM_SDK_READY:"PLATFORM_SDK_READY",CONTROLLER_COMPONENT_TYPE:"platform.components.AppController",TPA_WIDGET_TYPE_TEMPLATE:{qname:{prefix:"$w",shortName:"IFrame"},componentType:"wysiwyg.viewer.components.tpapps.TPAWidget",tagName:"",members:null,events:null,baseTypes:{},inheritanceChain:null},ACTION_CONNECT:"connect",EVENTS:{controllerSettingsButtonClicked:"controllerSettingsButtonClicked",componentConnectButtonClicked:"componentConnectButtonClicked",createCollectionButtonClicked:"openCreateNewCollection",formBuilderAppClicked:"formBuilderAppClicked"},panelTypes:{COMPONENT_PANEL:"componentPanel",FULL_STAGE:"fullStagePanel",MODAL:"modalPanel",TOOL:"toolPanel",TOOL_BAR:"toolBarPanel"},pages:{page_settings:{layout:"Pages_Layouts_Tab_Title",permissions:"Pages_Permissions_Tab_Title"},page_actions:{rename:{title:"Pages_Actions_Page_Rename",icon:"quickActionsRename"}}},controller:{DEFAULT_STATE:"default"}}}),define("platform/bi/events.json",[],function(){return{CONTROLLER_GFPP_CLICK:{evid:26,src:79,endpoint:"platform",fields:{app_name:"string",action_name:"string",controller_type:"string",component_id:"string",pageId:"string"}},page_delete_dataset:{evid:91,src:79,endpoint:"platform",fields:{app_name:"string",controller_type:"string",component_id:"string",pageId:"string"}}}}),define("platform/appController/controllerSettingsGfpp",["lodash","platform/common/constants","platform/bi/events.json"],function(e,t,n){function o(e,t){a.enabledActions=[t.HELP],e("AppController",a)}function r(o,r,i){var a=e.head(i),p=r.components.data.get(a),c=t.EVENTS.controllerSettingsButtonClicked,l=r.documentServices.platform.controllers.settings.get(a),s=r.documentServices.platform.controllers.getName(a),u={controllerRef:a,controllerConfig:l,controllerType:p.controllerType,controllerDisplayName:s,origin:"gfpp"};r.bi.event(n.CONTROLLER_GFPP_CLICK,{action_name:o,app_name:p.applicationId,controller_type:p.controllerType,component_id:a.id,pageId:r.pages.getCurrentPageId()});var f=r.documentServices.platform.getAppDataByAppDefId(p.applicationId);r.documentServices.platform.notifyApplication(f.applicationId,{eventType:c,eventPayload:u})}var i={dataset:"7f921134-acd3-4771-ac24-33bbeafefb90",router_dataset:"7f921134-acd3-4771-ac24-33bbeafefb90"},a={mainActions:[{label:"Manage Dataset",shouldTranslate:!1,onClick:r.bind(null,"Manage Dataset")}],presetActions:{help:{helpId:function(e,t){var n=e.components.data.get(t).controllerType;return i[n]||"3c9b0528-699b-475f-818c-2123885cb11f"}}}};return{init:o}}),define("platform/appController/appController",["lodash","platform/appController/controllerSettingsGfpp","platform/bi/events.json"],function(e,t,n){function o(t,n){return e(n).reduce(function(e,n){return t.components.is.container(n)?e.concat(n,t.components.get.byAncestor(n)):e.concat(n)},[]).some(function(e){return"platform.components.AppController"===t.components.getType(e)})}function r(t,n){function o(n){return r=r||e.keyBy(i,"id"),e(n).map("controllerRef").some(function(e){var n=e.id;return!r[n]&&t.components.getPage(e).id!==t.pages.getMasterPageId()})}var r,i=e.reduce(n,function(e,n){return t.components.is.container(n)?e.concat(n,t.components.get.byAncestor(n)):e.concat(n)},[]);return e.some(i,function(n){var r=t.documentServices.platform.controllers.connections.get(n);return!e.isEmpty(r)&&o(r)})}function i(t,n,i){function a(n){t.panelManager.openPanel("platform.panels.warnForDisconnectedComponentsPanel",e.assign({undo:t.history.undo},n))}n=e.isArray(n)?n:[n];var p=t.components.isShowOnAllPages(n),c=t.components.isShowOnAllPages(i);p&&!c&&o(t,n)&&a({controllerComp:!0}),!p&&c&&r(t,n)&&a({connectedComps:!0})}function a(e,t){var o=e.components.data.get(t);e.bi.event(n.page_delete_dataset,{app_name:o.applicationId,controller_type:o.controllerType,controller_id:t.id,pageId:e.documentServices.pages.getPrimaryPageId()})}function p(e,n,o){return t.init(n,o),e.registerCannotRemovePlugin("platform.components.AppController",a.bind(null,e)),e.editorEventRegistry.register(e.editorEventRegistry.constants.events.SET_CONTAINER,i),this}return{init:p}}),define("platform/common/utils",["lodash","util"],function(e,t){function n(e){return"platformPanels."+e}function o(n,o,r,i){var a=e.chain(window.location.search.substr(1)).thru(t.url.parseUrlParams).get("editorPlatformAppSources","").split(",").invokeMap("split",":").fromPairs().value();if(e.startsWith(o,"http"))return t.url.setUrlParam(o,"applicationId",i);var p=function(o){var a=e.get(n.documentServices.platform.getAppDataByAppDefId(r),"editorArtifact");if(a){var p=o?t.url.joinURL(t.serviceTopology.scriptsDomainUrl,"services",a,o):t.serviceTopology.scriptsLocationMap[a];return t.url.setUrlParam(p+"/","applicationId",i)}}(a[r]),c=new URL(o,p).href;return t.url.setUrlParam(c,"applicationId",i)}return{getPanelName:n,getFullApplicationUrl:o}}),define("platform/connection/connectableComponentsConfig",["lodash","experiment"],function(e,t){function n(){return t.isOpen("se_addConnectButtonToTpaGalleries")&&(o=[].concat(o,r)),t.isOpen("se_addFileUploaderConnect")&&(o=[].concat(o,["FileUploader"])),[].concat(o)}var o=["WRichText","Image","MatrixGallery","PaginatedGridGallery","SliderGallery","SlideShowGallery","SiteButton","TextInput","TextAreaInput","Checkbox","RadioButton","RadioGroup","OptionsListInput","WPhoto","ImageButton","ComboBoxInput","Grid","DatePicker"],r=["Impress","Masonry","Thumbnails","StripSlideshow","StripShowcase","Accordion","Freestyle","Collage","Honeycomb","SlideShowGallery","TPA3DGallery","TPA3DCarousel"];return{getConnectableComponents:n}}),define("platform/connection/connectableComponents",["lodash","platform/common/constants","platform/connection/connectableComponentsConfig"],function(e,t,n){function o(e){n.getConnectableComponents().forEach(function(t){e(t,r)})}var r={enabledActions:[t.ACTION_CONNECT]};return{registerGfpp:o}}),define("platform/connection/connection",["lodash","platform/common/constants","platform/common/utils","platform/connection/connectableComponents"],function(e,t,n,o){function r(t,n){var o=t.documentServices.platform.controllers.connections.get(e.head(n)),r=!1;return e.forEach(o,function(e){"ConnectionItem"===e.type&&(r=!0)}),r}function i(e,t){return e(p),o.registerGfpp(t),this}function a(n,o){var r=n.documentServices.platform.getInstalledAppsData(),i=1===r.length?e.head(r):"multiple application ids provided - TODO",a=e.head(o),p=t.EVENTS.componentConnectButtonClicked,c={componentRef:a,componentType:n.components.getType(a),componentSdkType:n.wixCode.getCompSdkType(a),origin:"gfpp"};n.documentServices.platform.notifyApplication(i.applicationId,{eventType:p,eventPayload:c})}var p={connect:{isSelected:function(o){var r=n.getPanelName(t.panelTypes.COMPONENT_PANEL);return e.some(o.panelManager.getOpenPanels(),{name:r})},isApplied:r,tooltip:"gfpp_component_connect",tooltip_active:"gfpp_component_connected_to_controllers",icon:"connect",rightClickMenuLabel:"PLATFORM_RightClick_Menu_Connect",className:function(e,t){return r(e,t)?"connected":""},onClick:a}};return{init:i,notifyConnectButtonClicked:a}}),define("platform/api/controllers/controllers",["lodash","bluebird"],function(e,t){function n(e,t){var n=t?t.id:null;return e.documentServices.components.getAllComponents(n,function(t){return e.components.getType(t)===g})}function o(){}function r(t,o,r,i){var a=n(t,e.get(i,"pageRef")||t.pages.getFocusedPage());return e.map(a,function(e){return{controllerRef:e}})}function i(t){var o=n(t);return e.map(o,function(e){return{controllerRef:e}})}function a(t,o,r,i){var a=n(t,t.components.getPage(i.componentRef));return e.map(a,function(e){return{controllerRef:e}})}function p(t,n,o,r){var i=t.documentServices.platform.controllers.connections.get(r.componentRef);return e.reject(i,{type:"WixCodeConnectionItem"})}function c(e,t,n,o){return e.documentServices.platform.controllers.connections.getConnectedComponents(o.controllerRef)}function l(e,t,n,o){e.documentServices.platform.controllers.connections.connect(o.connectToRef,o.controllerRef,o.role,o.connectionConfig)}function s(e,t,n,o){e.documentServices.platform.controllers.connections.disconnect(o.connectToRef,o.controllerRef,o.role)}function u(t,n,o,r){var i=t.documentServices.platform.controllers.settings.get(r.controllerRef);return{type:e.get(t.components.data.get(r.controllerRef),"controllerType"),config:i,displayName:t.documentServices.platform.controllers.getName(r.controllerRef)}}function f(e,n,o,r){return e.documentServices.platform.controllers.settings.set(r.controllerRef,r.config),new t(e.documentServices.waitForChangesApplied)}function d(e,n,o,r){return e.documentServices.platform.controllers.setName(r.controllerRef,r.name),new t(e.documentServices.waitForChangesApplied)}function m(e,n,o,r){return e.documentServices.platform.controllers.setState(r.state),new t(e.documentServices.waitForChangesApplied)}var g="platform.components.AppController";return{getAllCollections:o,listControllers:r,listAllControllers:i,listConnectableControllers:a,listConnections:p,listConnectedComponents:c,connect:l,disconnect:s,getData:u,saveConfiguration:f,setDisplayName:d,setState:m}}),define("platform/services/tokenService",["lodash"],function(e){function t(t){return e.uniqueId("platform_"+t+"_")}function n(t){return e.uniqueId("platform_"+t)}return{generatePanelToken:t,generateStaticGlobalPanelToken:n}}),define("platform/api/editor/utils/utils",["util"],function(e){function t(t,n,o,r){return e.link.getLinkValueAsString(t,r.link)}return{getLinkAsString:t}}),define("platform/api/editor/editor",["lodash","jquery","bluebird","pmrpc","constants","platform/common/constants","platform/common/utils","platform/services/tokenService","platform/api/editor/utils/utils","stateManagement"],function(e,t,n,o,r,i,a,p,c,l){function s(e,t,n,o){var p=I(e,t,o);e.selection.selectComponentByCompRef(o.componentRef),e.panelManager.openPlatformPanel({panelName:a.getPanelName(i.panelTypes.COMPONENT_PANEL),panelProps:p,panelMetaData:{frameType:r.PANEL_TYPES.COMP,closeAllOtherPanels:!0}})}function u(e,t,o,r){var p=I(e,t,r);return new n(function(t){e.panelManager.openPlatformPanel({panelName:a.getPanelName(i.panelTypes.MODAL),panelProps:p,panelMetaData:{resolve:t}})})}function f(t,n,o,r){var i=t.documentServices.pages.getPagesData(),a=r.pageRef.id,p=t.pages.dynamicPages.getMenuItems(),c=e.flatMap(p,"items"),l=t.mainMenu.getMenuItemsFlattened(i),s=e.find(l,["pageData.id",a])||e.find(c,{id:a}),u=t.pages.dynamicPages.getDynamicPageOptions(a,"pageSettings")||[],f={menuItemToShowSettingsFor:s,selectedSettingsTab:e.isEmpty(u)?null:u[0].title};t.navigateAndOpenPagesPanel(a,f)}function d(n,o){o=o||{};var r=n.panelManager.getOpenPanels(),i=e.find(r,{type:"platform"});if(i){var a=t('[name="'+i.token+'"]');if(a){var p=a.offset();if(p&&e.isNumber(p.top)&&e.isNumber(p.left)){if(e.isNumber(o.x)&&e.isNumber(o.y))return{top:p.top+o.y,left:p.left+o.x};if(e.isNumber(o.height)&&e.get(i,"props.height")&&e.get(i,"props.width"))return{top:p.top+i.props.height/2-o.height/2,left:p.left+i.props.width/2}}}}return{top:"25%",left:"45%"}}function m(t,o,r,p){var c=I(t,o,p),l=a.getPanelName(i.panelTypes.TOOL),s=d(t,p);return e.merge(c,s),new n(function(e){t.panelManager.openPlatformPanel({panelName:l,panelProps:c,panelMetaData:{resolve:e}})})}function g(t,o,r,i){return new n(function(n){var o={link:e.get(i,"value",null),callback:n,onCancelCallback:n};t.openLinkPanel(o)})}function v(t,o,r,i){return i=e.defaults(i||{},{callOnCancel:!0,isMultiSelect:!0,mediaType:"IMAGE"}),new n(function(n){var o=function(t){var o;e.isEmpty(t)?i.callOnCancel&&(o=null):(e.isArray(t)||(t=[t]),o=t.map(function(e){return{uri:e.uri,title:e.title,width:e.width,height:e.height}})),n(o)};t.mediaServices.mediaManager.open(i.mediaType,{multiSelect:i.isMultiSelect,callback:o})})}function P(e,t,n,o){var r={origin:"platform"},i={component:e.selection.getSelectedComponentType(),learn_more:!1,panel_name:"platform"};e.panelManager.openHelpCenter(o.helpId,r,i)}function I(t,n,o){var r=t.documentServices.platform.getAppDataByApplicationId(n.applicationId),i=e.assign({token:p.generatePanelToken(r.appDefinitionId)},o);return o.url&&e.assign(i,{url:a.getFullApplicationUrl(t,o.url,r.appDefinitionId,r.applicationId)}),i}function S(e,t,n,o){var p=I(e,t,o);e.panelManager.openPlatformPanel({panelName:a.getPanelName(i.panelTypes.FULL_STAGE),panelProps:p,panelMetaData:{frameType:r.PANEL_TYPES.FULL_STAGE,closeAllOtherPanels:!0}})}function _(t,n){return e.find(t.panelManager.getOpenPanels(),{token:n})}function A(e,t,n,o){var r=_(e,n);if(r){var i=I(e,t,o);i.token=n,e.panelManager.updatePanelProps(r.name,i)}}function C(e,t,n,o){e.store.dispatch(l.panels.logic.closePlatformPanel(n,o))}function T(e,t){o.api.request(t.applicationId,{target:e.documentServices.platform.getAppsContainer()}).then(function(e){o.api.set(t.applicationId,e)})}return{openComponentPanel:s,openModalPanel:u,openToolPanel:m,openPagePanel:f,openFullStagePanel:S,openLinkPanel:g,openMediaPanel:v,openHelpPanel:P,updatePanelOptions:A,closePanel:C,setAppAPI:T,utils:c}}),define("platform/api/preview/preview",["bluebird"],function(e){function t(t,n,o,r){return new e(function(e){t.documentServices.platform.pages.navigateTo(r.pageUrl,function(){t.preview.isInPreviewMode()?e():t.preview.togglePreview(e)})})}return{navigateTo:t}}),define("platform/api/vfs/vfs",["lodash"],function(e){function t(e,t,n,o){var r=e.wixCode.fileSystem,i=r.getVirtualDescriptor(o.path,!1);return r.readFile(i)}function n(t,n,r,i){var a=t.wixCode.fileSystem,p=a.getVirtualDescriptor(i.path,!0);return a.getChildren(p).then(function(t){return e.map(t,o)})}function o(e){return{name:e.name,fullPath:e.location,isDirectory:e.directory}}function r(e,t,n,o){var r=e.wixCode.fileSystem,i=r.getVirtualDescriptor(o.path,!1);return r.writeFile(i,o.content)}function i(e){return e.wixCode.fileSystem.flush()}return{listChildren:n,readFile:t,writeFile:r,flush:i}}),define("platform/api/pages/pages",["lodash","util","bluebird"],function(e,t,n){function o(t,o,r,i){var a=e.get(i.pageRef,"id");if(a)return new n(function(e){t.pages.navigateTo(a,function(){e()})})}function r(e){return e.documentServices.pages.getReference(e.documentServices.pages.getFocusedPageId())}function i(e,n,o,r){var i=r.pageRef.id,a=t.validate.pageNameValidator(r.title);return a||e.pages.data.update(i,{title:r.title}),a}function a(e,t,o,r){return new n(function(t){var n=e.pages.add(r.title,r.definition);e.pages.navigateTo(n.id,function(){t(n)})})}function p(e,t,n,o){var r=o.pageRef.id;e.pages.data.update(r,{hidePage:o.hidePage})}function c(t,n,o,r){var i=r.pageRef.id,a=t.pages.data.get(i);return e.pick(a,["title","hidePage"])}return{navigateTo:o,getCurrent:r,rename:i,add:a,toggleHidePage:p,getPageData:c}}),define("platform/api/components/components",["bluebird","lodash"],function(e,t){function n(e,n,o){var r=t.get(o,"pageRef.id")||e.documentServices.pages.getFocusedPageId(),i=e.pasteLogic.addContext.getPastePosition(e,n.layout,r);t.merge(n.layout,i)}function o(o,r,i,a){return new e(function(e,r){t.isEmpty(a.componentDefinition.componentType)&&r(new Error("componentDefinition must contain componentType"));var i=o.components.buildDefaultComponentStructure(a.componentDefinition.componentType);n(o,i,a),t.merge(i,a.componentDefinition);var p=o.components.add(a.pageRef,i,void 0,void 0,"editorSdk");o.documentServices.waitForChangesApplied(function(){o.components.is.exist(p)?e(p):r(new Error("Could not add component"))})})}function r(e,t,n,o){return e.documentServices.components.remove(o.componentRef)}function i(e,t,n,o){return e.components.properties.get(o.componentRef)}function a(e,t,n,o){e.components.properties.update(o.componentRef,o.props)}function p(e,t,n,o){return e.components.getPage(o.componentRef)}function c(e,t,n,o){return e.components.data.get(o.componentRef)}function l(e,t,n,o){e.components.data.update(o.componentRef,o.data)}return{add:o,remove:r,getPage:p,properties:{get:i,update:a},data:{get:c,update:l}}}),define("platform/api/routers/routers",["lodash","util","bluebird"],function(e,t,n){function o(t,o,r,i){return new n(function(n,r){var a={appDefinitionId:e.get(t.documentServices.platform.getAppDataByApplicationId(o.applicationId),"appDefinitionId"),prefix:e.get(i,"prefix"),config:e.get(i,"config")};e.get(i,"group")&&(a.group=i.group);var p=t.documentServices.routers.add(a);t.documentServices.waitForChangesApplied(function(){t.documentServices.routers.get.byRef(p)?n(p):r(new Error("Could not add router"))})})}function r(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return t.documentServices.routers.remove(r.routerRef)}function i(t,n,o,r){var i=t.documentServices.routers.get.byRef(r.routerRef),a=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId");if(i&&a===i.appDefinitionId)return{prefix:i.prefix,config:i.config,pages:e(i.pages).invertBy().map(function(e,n){return{pageRef:t.documentServices.pages.getReference(n),pageRoles:e}}).value()}}function a(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(r.routerRef);a&&a.appDefinitionId===i&&t.documentServices.routers.update(r.routerRef,r)}function p(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return t.documentServices.routers.pages.add(r.routerRef,r.pageTitle,r.pageRoles)}function c(t,o,r,i){return new n(function(n,r){var a=e.get(t.documentServices.platform.getAppDataByApplicationId(o.applicationId),"appDefinitionId"),p=t.documentServices.routers.get.byRef(i.routerRef);p&&p.appDefinitionId===a?t.pages.remove(i.pageRef.id,function(){n()},function(){r()},!1):r()})}function l(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return t.documentServices.routers.pages.connect(r.routerRef,r.pageRef,r.pageRoles)}function s(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return t.documentServices.routers.pages.disconnect(r.routerRef,r.pageRef)}function u(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(r.fromRouterRef),p=t.documentServices.routers.get.byRef(r.toRouterRef);if(a&&p&&p.appDefinitionId===i&&a.appDefinitionId===i)return t.documentServices.routers.pages.move(r.pageRef,r.fromRouterRef,r.toRouterRef)}function f(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.getRouterRef.byPage(r.pageRef);if(!a)return a;var p=t.documentServices.routers.get.byRef(a);return p&&p.appDefinitionId===i?a:void 0}function d(t,n,o){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId");return e.map(t.documentServices.routers.get.byApp(r),function(e){var r=m(t,n,o,{prefix:e.prefix});return i(t,n,o,{routerRef:r})})}function m(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.getRouterRef.byPrefix(r.prefix);if(!a)return a;var p=t.documentServices.routers.get.byRef(a);return p&&p.appDefinitionId===i?a:void 0}function g(n,o,r,i){var a=e.get(o,"applicationId"),p=n.documentServices.routers.isValidPrefix(a,i.prefix);if(!p.valid){var c="";switch(p.message){case 1:c="DYNAMIC_PAGES_VALIDATION_PREFIX_CAN_NOT_BE_EMPTY";break;case 2:c="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_TOO_LONG";break;case 3:c="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_DUPLICATE_OF_URISEO";break;case 4:c="DYNAMIC_PAGES_VALIDATION_PREFIX_CONTAINS_INVALID_CHARCTERS";break;case 5:c="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_FORBIDDEN_WORD";break;case 6:c="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_IN_USE_BY_ANOTHER_APPLICATION"}p.message=t.translate(c)}return p}function v(e){return e.documentServices.routers.pages.listConnectablePages()}return{add:o,remove:r,get:i,getAll:d,update:a,getByPage:f,getByPrefix:m,isValidPrefix:g,pages:{add:p,delete:c,connect:l,disconnect:s,move:u,listConnectablePages:v}}}),define("platform/api/history/history",["bluebird"],function(e){function t(t,n,o,r){return new e(function(e){t.documentServices.waitForChangesApplied(function(){t.history.add(r.label),e()})})}return{add:t}}),define("platform/api/ide/ide",["lodash","bluebird"],function(e,t){function n(t,n){return e.startsWith(n,t)&&e.endsWith(n,".json")}function o(e,t){return t.replace(e,"").replace(".json","")}function r(e,t,n,o){return e.wixCode.collectionsTree.navigateToCollection(e,o.name)}function i(t,i,a,p){var c=p.path,l=t.wixCode.fileSystem.getRoots().schemas.location;return n(l,c)?r(t,i,a,{name:o(l,p.path)}):t.wixCode.fileTree.navigateToFile(t,p.path,e.pick(p,["functionName","caretOffset"]))}function a(e){return e.developerMode.ui.treePane.isOpen()}function p(e){return new t(function(t){e.developerMode.ui.treePane.toggle(function(){t()})})}return{openFile:i,navigateToCollection:r,treePane:{isOpen:a,toggle:p}}}),define("platform/api/info/info",["lodash","bluebird","util"],function(e,t,n){function o(n,o){return new t(function(t,r){var i=f(n),c=e.get(n.documentServices.platform.getAppDataByApplicationId(o.applicationId),"appDefinitionId");i?t(c===n.documentServices.platform.editorApps.DATA_BINDING.appDefId?p(n):a(n,c)):c===n.documentServices.platform.editorApps.DATA_BINDING.appDefId?n.saveManager.saveInBackground(function(){t(p(n))},r):n.saveManager.saveInBackground(function(){t(a(n,c))},r)})}function r(e){return e.documentServices.generalInfo.getMetaSiteId()}function i(){return n.editorSessionUtil.editorSessionId}function a(e,t){return["//",u(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/app/",t,"?referralInfo=editor"].join("")}function p(e){return["//",u(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/simple-app","?app=wixcode","&referralInfo=editor_platform"].join("")}function c(e,t){var n=t.applicationId;return e.documentServices.platform.getAppDataByApplicationId(n).appDefinitionId}function l(e){return e.getDeviceType()}function s(e){return e.documentServices.generalInfo.getSiteId()}function u(){var e=window.location.hostname.match(/editor\.(.*)/);return e?"www."+e[1]:"www.wix.com"}function f(e){return!e.documentServices.generalInfo.isFirstSave()}function d(e){return e.documentServices.generalInfo.isSitePublished()}var m=window.mainLoaded||0;return{getDashboardUrl:o,getMetaSiteId:r,getEditorSessionId:i,getSiteId:s,getEditorReadyTimestamp:function(){return e.now()-m},getEditorMode:l,getAppDefinitionId:c,isSitePublished:d}}),define("platform/api/environment/environment",["util"],function(e){function t(){return e.editorModel.languageCode}return{getLocale:t}}),define("platform/api/siteSegments/siteSegments",[],function(){function e(e){return e.siteSegments.getFooter()}function t(e){return e.siteSegments.getHeader()}function n(e){return e.siteSegments.getPagesContainer()}function o(e){return e.siteSegments.getSiteStructure()}return{getFooter:e,getHeader:t,getPagesContainer:n,getSiteStructure:o}}),define("platform/api/userPreferences/userPreferences",["lodash"],function(e){function t(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId");if(!i)throw new Error("Illegal appData - application is not registered in clientSpecMap");e.forEach(r,function(e,n){t.userPreferences.site.set(n,e,null,null,i)})}function n(t,n,o,r){var i=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId");if(!i)throw new Error("Illegal appData - application is not registered in clientSpecMap");var a=e.isArray(r)?e(r).keyBy().mapValues(e.noop).value():r,p=e.mapValues(a,function(e,n){return t.userPreferences.site.get(n,i)});return e.defaults(p,a)}return{site:{set:t,get:n}}}),define("platform/api/internalAPIs",["lodash"],function(e){function t(t,n,o){t.wixCode.provision(e.noop,e.noop),t.documentServices.platform.initApp({appDefinitionId:e.get(o,"appDefinitionId"),editorUrl:e.get(o,"editorUrl"),viewerUrl:e.get(o,"viewerUrl")})}return{addApp:t}}),define("platform/api/api",["lodash","platform/api/controllers/controllers","platform/api/editor/editor","platform/api/preview/preview","platform/api/vfs/vfs","platform/api/pages/pages","platform/api/components/components","platform/api/routers/routers","platform/api/history/history","platform/api/ide/ide","platform/api/info/info","platform/api/environment/environment","platform/api/siteSegments/siteSegments","platform/api/userPreferences/userPreferences","platform/api/internalAPIs"],function(e,t,n,o,r,i,a,p,c,l,s,u,f,d,m){return{editor:n,preview:o,controllers:t,vfs:r,components:a,routers:p,history:c,ide:l,pages:i,info:s,environment:u,userPreferences:d,siteSegments:f,__internal__:m}}),define("platform/services/platformPostMessageService",["lodash","pmrpc","platform/common/constants"],function(e,t,n){function o(e,t){return function(o){if(o.data.intent===n.PLATFORM_PANEL&&o.data.sourcePanel===t)switch(o.data.type){case n.PLATFORM_SDK_READY:r(o.source,{intent:n.PLATFORM_ON_EVENT,event:{eventType:"startConfiguration",eventPayload:e}});break;default:return}}}var r=function(t,n,o){e.isUndefined(t)||(t.postMessage||(t=t.contentWindow),t.postMessage(n,o||"*"))};return{init:function(e,o){t.api.set(n.EDITOR_API_NS,o,{onApiCall:e.documentServices.platform.reportAPICallBI})},createPostMessageListener:o}}),define("platform/panels/appControllerDeleteConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,t,n,o){return function(){return e.createElement(n.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.appControllerDeleteConfirmationPanel",onConfirm:this.props.onConfirm,confirmLabel:"PLATFORM_messages_delete",cancelLabel:"PLATFORM_messages_cancel_delete",panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"deleteBlogConfirmationIcon"})),e.createElement("div",{className:"content"},e.createElement("p",{},this.getContentText())))}}),define("platform/panels/appControllerDeleteConfirmationPanel",["react","core","util","platform/panels/appControllerDeleteConfirmationPanel.rt"],function(e,t,n,o){return e.createClass({displayName:"appControllerDeleteConfirmationPanel",mixins:[n.translationMixin,t.mixins.editorAPIMixin],propTypes:{controllerDisplayName:e.PropTypes.string,isSingleController:e.PropTypes.bool,onConfirm:e.PropTypes.func},getContentText:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_text":"PLATFORM_messages_multidelete_dataset_text";return this.translateTemplate(e,{appName:"Wix Database"},this.getEditorAPI())},getTitle:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_title":"PLATFORM_messages_multidelete_dataset_title";return this.translateTemplate(e,{appControllerName:this.props.controllerDisplayName},this.getEditorAPI())},render:o})}),define("platform/panels/warnForDisconnectedComponentsPanel.rt",["react","lodash","panels","baseUI"],function(e,t,n,o){return function(){return e.createElement(n.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.warnForDisconnectedComponentsPanel",onCancel:this.props.undo,confirmLabel:"PLATFORM_messages_continue",cancelLabel:"PLATFORM_messages_cancel",shouldCloseByDefaultOnConfirm:!0,panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"platformWarning"})),this.props.connectedComps?e.createElement("div",{className:"content",key:"connectedCompsContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line2"))):null,this.props.connectedComps?null:e.createElement("div",{className:"content",key:"connectedDatasetContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line2"))))}}),define("platform/panels/warnForDisconnectedComponentsPanel",["react","lodash","util","platform/panels/warnForDisconnectedComponentsPanel.rt"],function(e,t,n,o){return e.createClass({displayName:"warnForDisconnectedComponentsPanel",mixins:[n.translationMixin],propTypes:{undo:e.PropTypes.func.isRequired,connectedComps:e.PropTypes.bool.isRequired},getTitle:function(){var e=this.props.connectedComps?"PLATFORM_messages_move_connected_element_title":"PLATFORM_messages_move_connected_dataset_title";return this.translateIfNeeded(e)},render:o})}),define("platform",["lodash","platform/appController/appController","platform/connection/connection","platform/api/api","platform/services/platformPostMessageService","platform/services/tokenService","platform/common/constants","platform/common/utils","platform/panels/appControllerDeleteConfirmationPanel","platform/panels/warnForDisconnectedComponentsPanel"],function(e,t,n,o,r,i,a,p,c,l){function s(e,i,a,p,c){var l=f(o,e),s=e.documentServices.platform.getAPIForSDK(l);t.init(e,a,c),n.init(i,p),r.init(e,s),e.documentServices.platform.init(l),e.registerSitePublishedCallbacks(u.bind(this,e))}function u(t){var n=t.platform.getInstalledEditorApps();e.forEach(n,function(e){t.documentServices.platform.notifyApplication(e.applicationId,{eventType:"siteWasPublished"})})}function f(t,n){return e.isFunction(t)?e.partial(t,n):e.isObject(t)?e.mapValues(t,function(e){return f(e,n)}):t}return{api:o,init:s,platformPostMessageService:r,tokenService:i,constants:a,utils:p,panels:{appControllerDeleteConfirmationPanel:c,warnForDisconnectedComponentsPanel:l}}});
//# sourceMappingURL=platform.min.js.map